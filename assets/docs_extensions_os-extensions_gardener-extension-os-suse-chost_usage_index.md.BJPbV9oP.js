import{_ as i,c as a,o as n,a2 as e}from"./chunks/framework.Bfq10Vlj.js";const g=JSON.parse('{"title":"Usage","description":"","frontmatter":{"github_repo":"https://github.com/gardener/gardener-extension-os-suse-chost","github_subdir":"docs/usage","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/extensions/os-extensions/gardener-extension-os-suse-chost/usage.md","to":"usage.md"},"persona":"Users","title":"Usage","prev":false,"next":false},"headers":[],"relativePath":"docs/extensions/os-extensions/gardener-extension-os-suse-chost/usage/index.md","filePath":"docs/extensions/os-extensions/gardener-extension-os-suse-chost/usage.md","lastUpdated":null}'),t={name:"docs/extensions/os-extensions/gardener-extension-os-suse-chost/usage/index.md"};function h(p,s,l,k,r,o){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="using-the-suse-chost-extension-with-gardener-as-end-user" tabindex="-1">Using the SuSE CHost extension with Gardener as end-user <a class="header-anchor" href="#using-the-suse-chost-extension-with-gardener-as-end-user" aria-label="Permalink to &quot;Using the SuSE CHost extension with Gardener as end-user&quot;">​</a></h1><p>The <a href="https://github.com/gardener/gardener/blob/master/example/90-shoot.yaml" target="_blank" rel="noreferrer"><code>core.gardener.cloud/v1beta1.Shoot</code> resource</a> declares a few fields that must be considered when this OS extension is used.</p><p>In this document we describe how this configuration looks like and under which circumstances your attention may be required.</p><h2 id="aws-vpc-settings-for-suse-chost-workers" tabindex="-1">AWS VPC settings for SuSE CHost workers <a class="header-anchor" href="#aws-vpc-settings-for-suse-chost-workers" aria-label="Permalink to &quot;AWS VPC settings for SuSE CHost workers&quot;">​</a></h2><p>Gardener allows you to create SuSE CHost based worker nodes by:</p><ol><li>Using a Gardener managed VPC</li><li>Reusing a VPC that already exists (VPC <code>id</code> specified in <a href="/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/usage/#infrastructureconfig">InfrastructureConfig</a>]</li></ol><p>If the second option applies to your use-case please make sure that your VPC has enabled <strong>DNS Support</strong>. Otherwise SuSE CHost based nodes aren&#39;t able to join or operate in your cluster properly.</p><p><strong><a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-dns.html" target="_blank" rel="noreferrer">DNS</a></strong> settings (required):</p><ul><li><code>enableDnsHostnames</code>: true</li><li><code>enableDnsSupport</code>: true</li></ul><h2 id="support-for-vsmp-memoryone" tabindex="-1">Support for vSMP MemoryOne <a class="header-anchor" href="#support-for-vsmp-memoryone" aria-label="Permalink to &quot;Support for vSMP MemoryOne&quot;">​</a></h2><p>This extension controller is also capable of generating user-data for the <a href="https://marketplace.cloud.vmware.com/services/details/vsmp-memoryone?slug=true" target="_blank" rel="noreferrer">vSMP MemoryOne</a> operating system in conjunction with SuSE CHost. It reacts on the <code>memoryone-chost</code> extension type.</p><h3 id="customizing-the-memoryone-hypervisor" tabindex="-1">Customizing the MemoryOne hypervisor <a class="header-anchor" href="#customizing-the-memoryone-hypervisor" aria-label="Permalink to &quot;Customizing the MemoryOne hypervisor&quot;">​</a></h3><p>To pass configuration parameters to the MemoryOne hypervisor, this extension supports two configuration types.</p><h4 id="legacy-configuration-deprecated" tabindex="-1">Legacy configuration <strong>(deprecated)</strong> <a class="header-anchor" href="#legacy-configuration-deprecated" aria-label="Permalink to &quot;Legacy configuration **(deprecated)**&quot;">​</a></h4><p>It is possible to configure the parameters for <code>memoryTopology</code> and <code>systemMemory</code> through respective dedicated fields:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">memoryone-chost.os.extensions.gardener.cloud/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OperatingSystemConfiguration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">memoryTopology</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">systemMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8x&quot;</span></span></code></pre></div><ul><li>The <code>memoryTopology</code> field controls the <code>mem_topology</code> setting. If it&#39;s not provided then it will default to <code>2</code>.</li><li>The <code>systemMemory</code> field controls the <code>system_memory</code> setting. If it&#39;s not provided then it defaults to <code>6x</code>.</li></ul><p>As these two fields are not sufficient to pass in any other of the several dozens of parameters that vSMP MemoryOne supports, it is possible to <em>inject</em> additional key-value pairs through either <code>memoryTopology</code> or <code>systemMemory</code> by separating them by a semicolon <code>;</code>:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">memoryone-chost.os.extensions.gardener.cloud/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OperatingSystemConfiguration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">memoryTopology</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3;debug_features=&amp;0xffffffff&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">systemMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;7x&quot;</span></span></code></pre></div><p>This however is discouraged and hence, the legacy fields for <code>memoryTopology</code> or <code>systemMemory</code> are <strong>deprecated</strong> and will be removed in a future version.</p><h4 id="new-vsmp-configuration-recommended" tabindex="-1">New vSMP configuration <strong>(recommended)</strong> <a class="header-anchor" href="#new-vsmp-configuration-recommended" aria-label="Permalink to &quot;New vSMP configuration **(recommended)**&quot;">​</a></h4><p>It is possible to configure any key-value pair that configures the vSMP MemoryOne hypervisor by passing them in the <code>vsmpConfiguration</code> map. Note, that the keys must be the ones that vSMP MemoryOne understands, i.e. <code>mem_topology</code> instead of <code>memoryTopology</code> and <code>system_memory</code> instead of <code>systemMemory</code>.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">memoryone-chost.os.extensions.gardener.cloud/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OperatingSystemConfiguration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">vsmpConfiguration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  mem_topology</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  system_memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;7x&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  debug_features</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&amp;0xffffff&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  pci_dev_filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">00:0a:ce</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></div><p>Internally, this is a <code>map[string]string</code> hence, numbers/integers and/or booleans must be quoted. If quotes are necessary in values, they can be escaped.</p><p><strong>Please note</strong> that semicola <code>;</code> are not allowed inside values for <code>vsmpConfiguration</code> - if a semicolon is found in a value, it and anything that follows will get stripped before being processed any further.</p><h3 id="using-vsmp-memoryone-with-shoots" tabindex="-1">Using vSMP MemoryOne with Shoots <a class="header-anchor" href="#using-vsmp-memoryone-with-shoots" aria-label="Permalink to &quot;Using vSMP MemoryOne with Shoots&quot;">​</a></h3><p>As the vSMP MemoryOne OS image you select in a Shoot manifest only contains the MemoryOne hypervisor, you will need a snapshot ID of a SuSE CHost/CHost volume (see below how to create it).</p><p>An exemplary worker pool configuration inside a <code>Shoot</code> resource using for the vSMP MemoryOne operating system would look as follows:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core.gardener.cloud/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Shoot</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">vsmp-memoryone</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">garden-foo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  workers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cpu-worker3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    minimum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    maximum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    maxSurge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    maxUnavailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    machine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">memoryone-chost</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9.5.195</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        providerConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">memoryone-chost.os.extensions.gardener.cloud/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OperatingSystemConfiguration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          vsmpConfiguration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            mem_topology</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            system_memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;7x&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            debug_features</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&amp;0xffffff&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            pci_dev_filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">00:0a:ce</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">c5d.metal</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volume</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">20Gi</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gp2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    dataVolumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">chost</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">50Gi</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gp2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    providerConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws.provider.extensions.gardener.cloud/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WorkerConfig</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      dataVolumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">chost</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        snapshotID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">snap-123456</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    zones</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">eu-central-1b</span></span></code></pre></div><p>Please consult the documentation of vSMP MemoryOne to find out which instance types on the different cloud providers support running vSMP MemoryOne.</p><h3 id="generating-an-aws-snapshot-id-for-the-chost-chost-operating-system" tabindex="-1">Generating an AWS snapshot ID for the CHost/CHost operating system <a class="header-anchor" href="#generating-an-aws-snapshot-id-for-the-chost-chost-operating-system" aria-label="Permalink to &quot;Generating an AWS snapshot ID for the CHost/CHost operating system&quot;">​</a></h3><p>The following script will help to generate the snapshot ID on AWS. It runs in the region that is selected in your <code>$HOME/.aws/config</code> file. Consequently, if you want to generate the snapshot in multiple regions, you have to run in multiple times after configuring the respective region using <code>aws configure</code>.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ami</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ami-1234&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #Replace the ami with the intended one.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2 describe-images </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--image-ids</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $ami</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --query=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Images[].Name&quot; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--output=text</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cur</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2 describe-snapshots </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--filter=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Name=description,Values=snap-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--query=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Snapshots[].Description&quot; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--output=text</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cur</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;AMI </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exists as snapshot </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cur</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  continue</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fi</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;AMI </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ... creating private snapshot&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inst</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2 run-instances </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--instance-type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> t3.nano </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--image-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $ami</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --query</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Instances[0].InstanceId&#39; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--output=text</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --subnet-id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> subnet-1234 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--tag-specifications</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ResourceType=instance,Tags=[{Key=scalemp-test,Value=scalemp-test}]&#39;\`</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #Replace the subnet-id with the intended one.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wait</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> instance-running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --instance-ids</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $inst</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2 describe-instances </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--instance-ids</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $inst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --query</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Reservations[].Instances[].BlockDeviceMappings[0].Ebs.VolumeId&quot; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--output=text</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">snap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2 create-snapshot </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--description</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;snap-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--volume-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $vol</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --query=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;SnapshotId&#39; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--tag-specifications</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ResourceType=snapshot,Tags=[{Key=Name,Value=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}]&quot; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--output=text</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wait</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> snapshot-completed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --snapshot-ids</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $snap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> terminate-instances</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --instance-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $inst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $snap</span></span></code></pre></div>`,33)]))}const E=i(t,[["render",h]]);export{g as __pageData,E as default};
