import{_ as i,c as a,o as e,a2 as t}from"./chunks/framework.Bfq10Vlj.js";const F=JSON.parse('{"title":"Getting Started Locally With Gardenadm","description":"","frontmatter":{"github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/deployment","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/deployment/getting_started_locally_with_gardenadm.md","to":"getting_started_locally_with_gardenadm.md"},"title":"Getting Started Locally With Gardenadm","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/deployment/getting_started_locally_with_gardenadm/index.md","filePath":"docs/gardener/deployment/getting_started_locally_with_gardenadm.md","lastUpdated":null}'),n={name:"docs/gardener/deployment/getting_started_locally_with_gardenadm/index.md"};function h(l,s,p,k,r,d){return e(),a("div",null,s[0]||(s[0]=[t(`<h1 id="deploying-self-hosted-shoot-clusters-locally" tabindex="-1">Deploying Self-Hosted Shoot Clusters Locally <a class="header-anchor" href="#deploying-self-hosted-shoot-clusters-locally" aria-label="Permalink to &quot;Deploying Self-Hosted Shoot Clusters Locally&quot;">​</a></h1><div class="caution custom-block github-alert"><p class="custom-block-title">CAUTION</p><p>The <code>gardenadm</code> tool is currently under development and considered highly experimental. Do not use it in production environments. Read more about it in <a href="https://github.com/gardener/gardener/blob/master/docs/proposals/28-self-hosted-shoot-clusters.md" target="_blank" rel="noreferrer">GEP-28</a>.</p></div><p>This document walks you through deploying Self-Hosted Shoot Clusters using <code>gardenadm</code> on your local machine. This setup can be used for trying out and developing <code>gardenadm</code> locally without additional infrastructure. The setup is also used for running e2e tests for <code>gardenadm</code> in CI (<a href="https://prow.gardener.cloud" target="_blank" rel="noreferrer">Prow</a>).</p><p>If you encounter difficulties, please open an issue so that we can make this process easier.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p><code>gardenadm</code> is a command line tool for bootstrapping Kubernetes clusters called &quot;Self-Hosted Shoot Clusters&quot;. Read the <a href="/docs/gardener/concepts/gardenadm/"><code>gardenadm</code> documentation</a> for more details on its concepts.</p><p>In this guide, we will start a <a href="https://kind.sigs.k8s.io/" target="_blank" rel="noreferrer">KinD</a> cluster which hosts pods serving as machines for the self-hosted shoot cluster – just as for shoot clusters of <a href="/docs/gardener/extensions/provider-local/">provider-local</a>. The setup supports both the &quot;unmanaged infrastructure&quot; and the &quot;managed infrastructure&quot; scenario of <code>gardenadm</code>.</p><p>Based on <a href="https://skaffold.dev/" target="_blank" rel="noreferrer">Skaffold</a>, the container images for all required components will be built and deployed into the cluster. This also includes the <code>gardenadm</code> CLI, which is installed on the machine pods by pulling the container image and extracting the binary.</p><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><ul><li>Make sure that you have followed the <a href="/docs/gardener/local_setup/">Local Setup guide</a> up until the <a href="/docs/gardener/local_setup/#get-the-sources">Get the sources</a> step.</li><li>Make sure your Docker daemon is up-to-date, up and running and has enough resources (at least <code>8</code> CPUs and <code>8Gi</code> memory; see <a href="https://docs.docker.com/desktop/mac/#resources" target="_blank" rel="noreferrer">here</a> how to configure the resources for Docker for Mac). <blockquote><p>Additionally, please configure at least <code>120Gi</code> of disk size for the Docker daemon.</p></blockquote></li></ul><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>You can clean up unused data with <code>docker system df</code> and <code>docker system prune -a</code>.</p></div><h2 id="setting-up-the-kind-cluster" tabindex="-1">Setting Up the KinD Cluster <a class="header-anchor" href="#setting-up-the-kind-cluster" aria-label="Permalink to &quot;Setting Up the KinD Cluster&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-single-node-up</span></span></code></pre></div><p>Please see <a href="/docs/gardener/deployment/getting_started_locally/#alternative-way-to-set-up-garden-and-seed-leveraging-gardener-operator">this documentation section</a> for more details.</p><p>All following steps assume that you are using the kubeconfig for this KinD cluster:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KUBECONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$PWD/example/gardener-local/kind/multi-zone/kubeconfig</span></span></code></pre></div><h2 id="unmanaged-infrastructure-scenario" tabindex="-1">&quot;Unmanaged Infrastructure&quot; Scenario <a class="header-anchor" href="#unmanaged-infrastructure-scenario" aria-label="Permalink to &quot;&quot;Unmanaged Infrastructure&quot; Scenario&quot;">​</a></h2><p>Use the following command to prepare the <code>gardenadm</code> unmanaged infrastructure scenario:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-up</span></span></code></pre></div><p>This will first build the needed images, deploy 2 machine pods using the <a href="https://github.com/gardener/gardener/tree/master/pkg/provider-local/node" target="_blank" rel="noreferrer"><code>gardener-extension-provider-local-node</code> image</a>, install the <code>gardenadm</code> binary on both of them, and copy the needed manifests to the <code>/gardenadm/resources</code> directory.</p><p>Afterward, you can use <code>kubectl exec</code> to execute <code>gardenadm</code> commands on the machines.</p><p>Let&#39;s start with exec&#39;ing into the <code>machine-0</code> pod:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-unmanaged-infra</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machine-0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@machine-0:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gardenadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bootstraps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> manages</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> self-hosted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clusters</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Gardener</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> project.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@machine-0:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /gardenadm/resources/manifests.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> core.gardener.cloud/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CloudProfile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> local</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span></code></pre></div><h3 id="bootstrapping-a-single-node-control-plane" tabindex="-1">Bootstrapping a Single-Node Control Plane <a class="header-anchor" href="#bootstrapping-a-single-node-control-plane" aria-label="Permalink to &quot;Bootstrapping a Single-Node Control Plane&quot;">​</a></h3><p>Use <code>gardenadm init</code> to bootstrap the first control plane node using the provided manifests:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@machine-0:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /gardenadm/resources</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Your</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Shoot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> has</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> initialized</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully!</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span></code></pre></div><h3 id="connecting-to-the-self-hosted-shoot-cluster" tabindex="-1">Connecting to the Self-Hosted Shoot Cluster <a class="header-anchor" href="#connecting-to-the-self-hosted-shoot-cluster" aria-label="Permalink to &quot;Connecting to the Self-Hosted Shoot Cluster&quot;">​</a></h3><p>The machine pod&#39;s shell environment is configured for easily connecting to the self-hosted shoot cluster. Just execute <code>kubectl</code> within a <code>bash</code> shell in the machine pod:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-unmanaged-infra</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machine-0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@machine-0:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">machine-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   4m11s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.32.0</span></span></code></pre></div><p>You can also copy the kubeconfig to your local machine and use a port-forward to connect to the cluster&#39;s API server:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-unmanaged-infra</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machine-0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/kubernetes/admin.conf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s/api.root.garden.local.gardener.cloud/localhost:6443/&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/shoot--garden--root.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-unmanaged-infra</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod/machine-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 6443:443</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># in a new terminal</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> export</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KUBECONFIG=/tmp/shoot--garden--root.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">machine-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   10m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.32.0</span></span></code></pre></div><h3 id="joining-a-worker-node" tabindex="-1">Joining a Worker Node <a class="header-anchor" href="#joining-a-worker-node" aria-label="Permalink to &quot;Joining a Worker Node&quot;">​</a></h3><p>If you would like to join a worker node to the cluster, generate a bootstrap token and the corresponding <code>gardenadm join</code> command on <code>machine-0</code> (the control plane node). Then exec into the <code>machine-1</code> pod to run the command:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@machine-0:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --print-join-command</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># now copy the output, terminate the exec session and start a new one for machine-1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-unmanaged-infra</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machine-1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># paste the copied &#39;gardenadm join&#39; command here and execute it</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@machine-1:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> join</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Your</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> has</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> been</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> instructed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> join</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> worker!</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span></code></pre></div><p>Using the kubeconfig as described in <a href="/docs/gardener/deployment/getting_started_locally_with_gardenadm/#connecting-to-the-self-hosted-shoot-cluster">this section</a>, you should now be able to see the new node in the cluster:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">machine-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   10m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.32.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">machine-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   37s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.32.0</span></span></code></pre></div><h2 id="managed-infrastructure-scenario" tabindex="-1">&quot;Managed Infrastructure&quot; Scenario <a class="header-anchor" href="#managed-infrastructure-scenario" aria-label="Permalink to &quot;&quot;Managed Infrastructure&quot; Scenario&quot;">​</a></h2><p>Use the following command to prepare the <code>gardenadm</code> managed infrastructure scenario:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SCENARIO=managed-infra</span></span></code></pre></div><p>This will first build the needed images and then render the needed manifests for <code>gardenadm bootstrap</code> to the <a href="https://github.com/gardener/gardener/tree/master/dev-setup/gardenadm/resources/generated/managed-infra" target="_blank" rel="noreferrer"><code>./dev-setup/gardenadm/resources/generated/managed-infra</code></a> directory.</p><h3 id="bootstrapping-the-self-hosted-shoot-cluster" tabindex="-1">Bootstrapping the Self-Hosted Shoot Cluster <a class="header-anchor" href="#bootstrapping-the-self-hosted-shoot-cluster" aria-label="Permalink to &quot;Bootstrapping the Self-Hosted Shoot Cluster&quot;">​</a></h3><p>Use <code>go run</code> to execute <code>gardenadm</code> commands on your machine:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> export</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> IMAGEVECTOR_OVERWRITE=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$PWD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/dev-setup/gardenadm/resources/generated/.imagevector-overwrite.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./cmd/gardenadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bootstrap</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./dev-setup/gardenadm/resources/generated/managed-infra</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[shoot--garden--root-control-plane-58ffc-2l6s7] Your Shoot cluster control-plane has initialized successfully</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span></code></pre></div><h3 id="connecting-to-the-self-hosted-shoot-cluster-1" tabindex="-1">Connecting to the Self-Hosted Shoot Cluster <a class="header-anchor" href="#connecting-to-the-self-hosted-shoot-cluster-1" aria-label="Permalink to &quot;Connecting to the Self-Hosted Shoot Cluster&quot;">​</a></h3><p><code>gardenadm init</code> stores the kubeconfig of the self-hosted shoot cluster in the <code>/etc/kubernetes/admin.conf</code> file on the control plane machine. To connect to the self-hosted shoot cluster, set the <code>KUBECONFIG</code> environment variable and execute <code>kubectl</code> within a <code>bash</code> shell in the machine pod:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machine=&quot;$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot--garden--root get po </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app=machine </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-oname</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot--garden--root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $machine </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@machine-shoot--garden--root-control-plane-58ffc-2l6s7:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> export</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KUBECONFIG=/etc/kubernetes/admin.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@machine-shoot--garden--root-control-plane-58ffc-2l6s7:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                    STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">machine-shoot--garden--root-control-plane-58ffc-2l6s7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   4m11s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.33.0</span></span></code></pre></div><p><code>gardenadm bootstrap</code> copies the kubeconfig from the control plane machine to the bootstrap cluster. You can also copy the kubeconfig to your local machine and use a port-forward to connect to the cluster&#39;s API server:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot--garden--root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubeconfig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jsonpath=&#39;{.data.kubeconfig}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> base64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --decode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s/api.root.garden.local.gardener.cloud/localhost:6443/&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/shoot--garden--root.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machine=&quot;$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot--garden--root get po </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app=machine </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-oname</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot--garden--root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$machine </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">6443:443</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># in a new terminal</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> export</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KUBECONFIG=/tmp/shoot--garden--root.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                    STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">machine-shoot--garden--root-control-plane-58ffc-2l6s7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   4m11s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.33.0</span></span></code></pre></div><h2 id="connecting-the-self-hosted-shoot-cluster-to-gardener" tabindex="-1">Connecting the Self-Hosted Shoot Cluster to Gardener <a class="header-anchor" href="#connecting-the-self-hosted-shoot-cluster-to-gardener" aria-label="Permalink to &quot;Connecting the Self-Hosted Shoot Cluster to Gardener&quot;">​</a></h2><p>After you have successfully bootstrapped a self-hosted shoot cluster (either via the <a href="/docs/gardener/deployment/getting_started_locally_with_gardenadm/#unmanaged-infrastructure-scenario">unmanaged infrastructure</a> or the <a href="/docs/gardener/deployment/getting_started_locally_with_gardenadm/#managed-infrastructure-scenario">managed infrastructure</a> scenario), you can connect it to an existing Gardener system. For this, you need to have a Gardener running locally in your KinD cluster. In order to deploy it, you can run</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SCENARIO=connect</span></span></code></pre></div><p>This will deploy <a href="/docs/gardener/concepts/operator/"><code>gardener-operator</code></a> and create a <code>Garden</code> resource (which will then be reconciled and results in a full Gardener deployment). Find all information about it <a href="/docs/gardener/deployment/getting_started_locally/#alternative-way-to-set-up-garden-and-seed-leveraging-gardener-operator">here</a>. Note, that in this setup, no <code>Seed</code> will be registered in the Gardener - it&#39;s just a plain garden cluster without the ability to create regular shoot clusters.</p><p>Once above command is finished, you can generate a bootstrap token using <code>gardenadm</code> to connect the shoot cluster to this Gardener instance. For this, you must have installed the <code>gardenadm</code> binary locally. You can build it via:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm</span></span></code></pre></div><p>This will install it to <code>./bin/gardenadm</code>, from where you can call it.</p><p>After you have completed this, you need to get a kubeconfig for <a href="/docs/gardener/concepts/operator/#accessing-the-virtual-garden-cluster">the Gardener instance</a> you want to connect the self-hosted shoot to. We will refer to the path of this kubeconfig as <code>&lt;path-to-garden-kubeconfig&gt;</code> in the following.</p><p>Now you can generate the bootstrap token and the full <code>gardenadm connect</code> command like this:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KUBECONFIG=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">path-to-garden-kubeconfi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./bin/gardenadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --print-connect-command</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --shoot-namespace=garden</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --shoot-name=root</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This will output a command similar to:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gardenadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> connect</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --bootstrap-token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --ca-certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://api.virtual-garden.local.gardener.cloud</span></span></code></pre></div><p>Copy the full output, exec once again into one of the control-plane machines of your self-hosted shoot cluster, and paste and run the generated <code>gardenadm connect</code> command there:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@machine-0:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> connect</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --bootstrap-token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --ca-certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://api.virtual-garden.local.gardener.cloud</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2025-11-10T08:12:32.287Z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	Using</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> resources</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	{&quot;configDir&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/gardenadm/resources/&quot;}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2025-11-10T08:12:32.334Z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	Initializing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> botanist</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fake</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	{&quot;cloudProfile&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;apiVersion&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;core.gardener.cloud/v1beta1&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;kind&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CloudProfile&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;name&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;local&quot;},</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;project&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;apiVersion&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;core.gardener.cloud/v1beta1&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;kind&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Project&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;name&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;garden&quot;},</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;shoot&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;apiVersion&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;core.gardener.cloud/v1beta1&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;kind&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Shoot&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;namespace&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;garden&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;name&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;root&quot;}}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2025-11-10T08:12:32.345Z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	{&quot;flow&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;connect&quot;}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2025-11-10T08:13:04.571Z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	Succeeded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	{&quot;flow&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;connect&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;task&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Waiting until gardenlet is ready&quot;}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2025-11-10T08:13:04.571Z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	Finished</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	{&quot;flow&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;connect&quot;}</span></span></code></pre></div><p>Once this is done, you can observe that there is now a <code>gardenlet</code> running in the self-hosted shoot cluster, which connects it to the Gardener instance:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@machine-0:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenlet</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gardenlet-6cbcb676f5-prh8f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                           1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             40m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gardenlet-6cbcb676f5-wwn8w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                           1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             40m</span></span></code></pre></div><p>You can also observe that the self-hosted shoot cluster is now registered as a shoot cluster in Gardener:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --kubeconfig=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">path-to-garden-kubeconfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Shoots</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAMESPACE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CLOUDPROFILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PROVIDER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   REGION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   K8S</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   HIBERNATION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   LAST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OPERATION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">garden</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      local</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1.33.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Awake</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pendin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        healthy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   42m</span></span></code></pre></div><h2 id="running-e2e-tests-for-gardenadm" tabindex="-1">Running E2E Tests for <code>gardenadm</code> <a class="header-anchor" href="#running-e2e-tests-for-gardenadm" aria-label="Permalink to &quot;Running E2E Tests for \`gardenadm\`&quot;">​</a></h2><p>Based on the described setup, you can execute the e2e test suite for <code>gardenadm</code>:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SCENARIO=unmanaged-infra</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SCENARIO=connect</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-e2e-local-gardenadm-unmanaged-infra</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># or</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardenadm-up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SCENARIO=managed-infra</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-e2e-local-gardenadm-managed-infra</span></span></code></pre></div><h2 id="tear-down-the-kind-cluster" tabindex="-1">Tear Down the KinD Cluster <a class="header-anchor" href="#tear-down-the-kind-cluster" aria-label="Permalink to &quot;Tear Down the KinD Cluster&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-single-node-down</span></span></code></pre></div>`,69)]))}const g=i(n,[["render",h]]);export{F as __pageData,g as default};
