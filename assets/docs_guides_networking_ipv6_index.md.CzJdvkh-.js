import{_ as a}from"./chunks/bring-your-own-vpc.D7wN6BTL.js";import{_ as i,c as e,o as t,a2 as n}from"./chunks/framework.Bfq10Vlj.js";const g=JSON.parse('{"title":"Support for IPv6 on AWS","description":"","frontmatter":{"category":"Networking","github_repo":"https://github.com/gardener/gardener-extension-provider-aws","github_subdir":"docs/usage","last_reviewed":"11.12.2024","level":"beginner","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/guides/networking/ipv6.md","to":"ipv6.md"},"publishdate":"2024-12-11","scope":"operator","title":"Support for IPv6 on AWS","weight":20,"prev":false,"next":false},"headers":[],"relativePath":"docs/guides/networking/ipv6/index.md","filePath":"docs/guides/networking/ipv6.md","lastUpdated":null}'),l={name:"docs/guides/networking/ipv6/index.md"};function o(r,s,h,p,c,d){return t(),e("div",null,s[0]||(s[0]=[n(`<h1 id="support-for-ipv6" tabindex="-1">Support for IPv6 <a class="header-anchor" href="#support-for-ipv6" aria-label="Permalink to &quot;Support for IPv6&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Gardener supports different levels of IPv6 support in shoot clusters. This document describes the differences between them and what to consider when using them.</p><p>In <a href="/docs/guides/networking/ipv6/#ipv6-ingress-for-ipv4-shoot-clusters">IPv6 Ingress for IPv4 Shoot Clusters</a>, the focus is on how an existing IPv4-only shoot cluster can provide dual-stack services to clients. Section <a href="/docs/guides/networking/ipv6/#ipv6-only-shoot-clusters">IPv6-only Shoot Clusters</a> describes how to create a shoot cluster that only supports IPv6. Finally, <a href="/docs/guides/networking/ipv6/#dual-stack-shoot-clusters">Dual-Stack Shoot Clusters</a> explains how to create a shoot cluster that supports both IPv4 and IPv6.</p><h2 id="ipv6-ingress-for-ipv4-shoot-clusters" tabindex="-1">IPv6 Ingress for IPv4 Shoot Clusters <a class="header-anchor" href="#ipv6-ingress-for-ipv4-shoot-clusters" aria-label="Permalink to &quot;IPv6 Ingress for IPv4 Shoot Clusters&quot;">​</a></h2><p>Per default, Gardener shoot clusters use only IPv4. Therefore, they also expose their services only via load balancers with IPv4 addresses. To allow external clients to also use IPv6 to access services in an IPv4 shoot cluster, the cluster needs to be configured to support dual-stack ingress.</p><p>It is possible to configure a shoot cluster to support dual-stack ingress, see <a href="/docs/guides/networking/dual-stack-ipv4-ipv6-ingress-aws/">Using IPv4/IPv6 (dual-stack) Ingress in an IPv4 single-stack cluster</a> for more information.</p><p>The main benefit of this approach is that the existing cluster stays almost as is without major changes, keeping the operational simplicity. It works very well for services that only require incoming communication, e.g. pure web services.</p><p>The main drawback is that certain scenarios, especially related to IPv6 callbacks, are not possible. This means that services, which actively call to their clients via web hooks, will not be able to do so over IPv6. Hence, those services will not be able to allow full-usage via IPv6.</p><h2 id="ipv6-only-shoot-clusters" tabindex="-1">IPv6-only Shoot Clusters <a class="header-anchor" href="#ipv6-only-shoot-clusters" aria-label="Permalink to &quot;IPv6-only Shoot Clusters&quot;">​</a></h2><h3 id="motivation" tabindex="-1">Motivation <a class="header-anchor" href="#motivation" aria-label="Permalink to &quot;Motivation&quot;">​</a></h3><p>IPv6-only shoot clusters are the best option to verify that services are fully IPv6-compatible. While <a href="/docs/guides/networking/ipv6/#dual-stack-shoot-clusters">Dual-Stack Shoot Clusters</a> may fall back on using IPv4 transparently, IPv6-only shoot clusters enforce the usage of IPv6 inside the cluster. Therefore, it is recommended to check with IPv6-only shoot clusters if a workload is fully IPv6-compatible.</p><p>In addition to being a good testbed for IPv6 compatibility, IPv6-only shoot clusters may also be a desirable eventual target in the IPv6 migration as they allow to support both IPv4 and IPv6 clients while having a single-stack with the cluster.</p><h3 id="creating-an-ipv6-only-shoot-cluster" tabindex="-1">Creating an IPv6-only Shoot Cluster <a class="header-anchor" href="#creating-an-ipv6-only-shoot-cluster" aria-label="Permalink to &quot;Creating an IPv6-only Shoot Cluster&quot;">​</a></h3><p>To create an IPv6-only shoot cluster, the following needs to be specified in the <code>Shoot</code> resource (see also <a href="/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/usage/#example-shoot-manifest-ipv6">here</a>):</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Shoot</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core.gardener.cloud/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  networking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ipFamilies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">IPv6</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    infrastructureConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws.provider.extensions.gardener.cloud/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">InfrastructureConfig</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        vpc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          cidr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.0.0/16</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        zones</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.32.0/20</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            internal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.48.0/20</span></span></code></pre></div><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p>Please note that <code>nodes</code>, <code>pods</code> and <code>services</code> should not be specified in <code>.spec.networking</code> resource.</p></div><p>In contrast to that, it is still required to specify IPv4 ranges for the VPC and the public/internal subnets. This is mainly due to the fact that public/internal load balancers still require IPv4 addresses as there are no pure IPv6-only load balancers as of now. The ranges can be sized according to the expected amount of load balancers per zone/type.</p><p>The IPv6 address ranges are provided by AWS. It is ensured that the IPv6 ranges are globally unique und internet routable.</p><p>Network interfaces with prefixes are supported with <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-types.html#instance-hypervisor-type" target="_blank" rel="noreferrer">Nitro-based instances</a>.</p><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p>Please make sure that your specified instance type for IPv6 is nitro-based. The same is valid for dual-stack.</p></div><h3 id="load-balancer-configuration" tabindex="-1">Load Balancer Configuration <a class="header-anchor" href="#load-balancer-configuration" aria-label="Permalink to &quot;Load Balancer Configuration&quot;">​</a></h3><p>The AWS Load Balancer Controller is automatically deployed when using an IPv6-only shoot cluster. When creating a load balancer, the corresponding annotations need to be configured, see <a href="https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/service/nlb/" target="_blank" rel="noreferrer">AWS Load Balancer Documentation - Network Load Balancer</a> for details.</p><p>The AWS Load Balancer Controller allows dual-stack ingress so that an IPv6-only shoot cluster can serve IPv4 and IPv6 clients. You can find an example <a href="/docs/guides/networking/dual-stack-ipv4-ipv6-ingress-aws/#creating-an-ipv4ipv6-dual-stack-ingress">here</a>. A mutating webhook will automatically add the required annotations. To disable this automated behavior, use the annotation <code>extensions.gardener.cloud/ignore-load-balancer: &quot;true&quot;</code>.</p><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p>When accessing Network Load Balancers (NLB) from within the same IPv6-only cluster, it is crucial to add the annotation <code>service.beta.kubernetes.io/aws-load-balancer-target-group-attributes: preserve_client_ip.enabled=false</code>. Without this annotation, if a request is routed by the NLB to the same target instance from which it originated, the client IP and destination IP will be identical. This situation, known as the hair-pinning effect, will prevent the request from being processed. (This also happens for internal load balancers in IPv4 clusters, but is mitigated by the NAT gateway for external IPv4 load balancers.)</p></div><h3 id="connectivity-to-ipv4-only-services" tabindex="-1">Connectivity to IPv4-only Services <a class="header-anchor" href="#connectivity-to-ipv4-only-services" aria-label="Permalink to &quot;Connectivity to IPv4-only Services&quot;">​</a></h3><p>The IPv6-only shoot cluster can connect to IPv4-only services via DNS64/NAT64. The cluster is configured to use the DNS64/NAT64 service of the underlying cloud provider. This allows the cluster to resolve IPv4-only DNS names and to connect to IPv4-only services.</p><p>Please note that traffic going through NAT64 incurs the same cost as ordinary NAT traffic in an IPv4-only cluster. Therefore, it might be beneficial to prefer IPv6 for services, which provide IPv4 and IPv6.</p><h2 id="dual-stack-shoot-clusters" tabindex="-1">Dual-Stack Shoot Clusters <a class="header-anchor" href="#dual-stack-shoot-clusters" aria-label="Permalink to &quot;Dual-Stack Shoot Clusters&quot;">​</a></h2><h3 id="motivation-1" tabindex="-1">Motivation <a class="header-anchor" href="#motivation-1" aria-label="Permalink to &quot;Motivation&quot;">​</a></h3><p>Dual-stack shoot clusters support IPv4 and IPv6 out-of-the-box. They can be the intermediate step on the way towards IPv6 for any existing (IPv4-only) clusters.</p><h3 id="creating-a-dual-stack-shoot-cluster" tabindex="-1">Creating a Dual-Stack Shoot Cluster <a class="header-anchor" href="#creating-a-dual-stack-shoot-cluster" aria-label="Permalink to &quot;Creating a Dual-Stack Shoot Cluster&quot;">​</a></h3><p>To create a dual-stack shoot cluster, the following needs to be specified in the <code>Shoot</code> resource:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Shoot</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core.gardener.cloud/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  networking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    pods</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.128.0/17</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.0.0/18</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.64.0/18</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ipFamilies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">IPv4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">IPv6</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    infrastructureConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws.provider.extensions.gardener.cloud/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">InfrastructureConfig</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        vpc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          cidr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.0.0/18</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        zones</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            workers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.0.0/19</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.32.0/20</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            internal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.48.0/20</span></span></code></pre></div><p>Please note that the only change compared to an IPv4-only shoot cluster is the addition of <code>IPv6</code> to the <code>.spec.networking.ipFamilies</code> field. The order of the IP families defines the preference of the IP family. In this case, IPv4 is preferred over IPv6, e.g. services specifying no IP family will get only an IPv4 address.</p><h3 id="bring-your-own-vpc" tabindex="-1">Bring your own VPC <a class="header-anchor" href="#bring-your-own-vpc" aria-label="Permalink to &quot;Bring your own VPC&quot;">​</a></h3><p>To create an IPv6 shoot cluster or a dual-stack shoot within your own Virtual Private Cloud (VPC), it is necessary to have an Amazon-provided IPv6 CIDR block added to the VPC. This block can be assigned during the initial setup of the VPC, as illustrated in the accompanying screenshot. <img src="`+a+`" alt="bring your own vpc"> An egress-only internet gateway is required for outbound internet traffic (IPv6) from the instances within your VPC. Please create one egress-only internet gateway and attach it to the VPC. Please also make sure that the VPC has an attached internet gateway and the following attributes set: <code>enableDnsHostnames</code> and <code>enableDnsSupport</code> as described under <a href="/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/usage/#infrastructureConfig">usage</a>.</p><h3 id="migration-of-ipv4-only-shoot-clusters-to-dual-stack" tabindex="-1">Migration of IPv4-only Shoot Clusters to Dual-Stack <a class="header-anchor" href="#migration-of-ipv4-only-shoot-clusters-to-dual-stack" aria-label="Permalink to &quot;Migration of IPv4-only Shoot Clusters to Dual-Stack&quot;">​</a></h3><p>To migrate an IPv4-only shoot cluster to Dual-Stack simply change the <code>.spec.networking.ipFamilies</code> field in the <code>Shoot</code> resource from <code>IPv4</code> to <code>IPv4, IPv6</code> as shown below.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Shoot</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core.gardener.cloud/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  networking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ipFamilies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">IPv4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">IPv6</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  ...</span></span></code></pre></div><p>You can find more information about the process and the steps required <a href="https://gardener.cloud/docs/gardener/networking/dual-stack-networking-migration/" target="_blank" rel="noreferrer">here</a>.</p><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p>Please note that the dual-stack migration requires the IPv4-only cluster to run in native routing mode, i.e. pod overlay network needs to be disabled. The default quota of routes per route table in AWS is 50. This restricts the cluster size to about 50 nodes. Therefore, please adapt (if necessary) the routes per route table limit in the Amazon Virtual Private Cloud quotas accordingly before switching to native routing. The maximum setting is currently 1000.</p></div><h3 id="load-balancer-configuration-1" tabindex="-1">Load Balancer Configuration <a class="header-anchor" href="#load-balancer-configuration-1" aria-label="Permalink to &quot;Load Balancer Configuration&quot;">​</a></h3><p>The AWS Load Balancer Controller is automatically deployed when using a dual-stack shoot cluster. When creating a load balancer, the corresponding annotations need to be configured, see <a href="https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/service/nlb/" target="_blank" rel="noreferrer">AWS Load Balancer Documentation - Network Load Balancer</a> for details.</p><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p>Please note that load balancer services without any special annotations will default to IPv4-only regardless how <code>.spec.ipFamilies</code> is set.</p></div><p>The AWS Load Balancer Controller allows dual-stack ingress so that a dual-stack shoot cluster can serve IPv4 and IPv6 clients. You can find an example <a href="/docs/guides/networking/dual-stack-ipv4-ipv6-ingress-aws/#creating-an-ipv4ipv6-dual-stack-ingress">here</a>. A mutating webhook will automatically add the required annotations. To disable this automated behavior, use the annotation <code>extensions.gardener.cloud/ignore-load-balancer: &quot;true&quot;</code>.</p><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p>When accessing external Network Load Balancers (NLB) from within the same cluster via IPv6 or internal NLBs via IPv4, it is crucial to add the annotation <code>service.beta.kubernetes.io/aws-load-balancer-target-group-attributes: preserve_client_ip.enabled=false</code>. Without this annotation, if a request is routed by the NLB to the same target instance from which it originated, the client IP and destination IP will be identical. This situation, known as the hair-pinning effect, will prevent the request from being processed.</p></div>`,47)]))}const E=i(l,[["render",o]]);export{g as __pageData,E as default};
