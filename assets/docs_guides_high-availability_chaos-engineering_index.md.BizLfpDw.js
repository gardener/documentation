import{_ as e,c as a,o as i,a2 as t}from"./chunks/framework.Bfq10Vlj.js";const c=JSON.parse('{"title":"Chaos Engineering","description":"","frontmatter":{"aliases":["/readmore/shoot-high-availability-chaos-engineering"],"category":"High Availability","github_repo":"https://github.com/gardener/chaos-engineering","github_subdir":"docs/tutorials","level":"advanced","params":{"github_branch":"main"},"path_base_for_github_subdir":{"from":"content/docs/guides/high-availability/chaos-engineering.md","to":"getting_started.md"},"publishdate":"2023-03-17","scope":"app-developer","title":"Chaos Engineering","prev":false,"next":false},"headers":[],"relativePath":"docs/guides/high-availability/chaos-engineering/index.md","filePath":"docs/guides/high-availability/chaos-engineering.md","lastUpdated":null}'),n={name:"docs/guides/high-availability/chaos-engineering/index.md"};function o(r,s,l,h,p,d){return i(),a("div",null,s[0]||(s[0]=[t(`<h1 id="chaos-engineering" tabindex="-1">Chaos Engineering <a class="header-anchor" href="#chaos-engineering" aria-label="Permalink to &quot;Chaos Engineering&quot;">‚Äã</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">‚Äã</a></h2><p>Gardener provides <a href="https://chaostoolkit.org" target="_blank" rel="noreferrer"><code>chaostoolkit</code></a> modules to simulate <em>compute</em> and <em>network</em> outages for various cloud providers such as <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/aws" target="_blank" rel="noreferrer">AWS</a>, <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/azure" target="_blank" rel="noreferrer">Azure</a>, <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/gcp" target="_blank" rel="noreferrer">GCP</a>, <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/openstack" target="_blank" rel="noreferrer">OpenStack/Converged Cloud</a>, and <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/vsphere" target="_blank" rel="noreferrer">VMware vSphere</a>, as well as <em>pod disruptions</em> for <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/k8s" target="_blank" rel="noreferrer">any Kubernetes cluster</a>.</p><p>The API, parameterization, and implementation is as homogeneous as possible across the different cloud providers, so that you have only minimal effort. As a Gardener user, you benefit from an <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/garden" target="_blank" rel="noreferrer">additional <code>garden</code> module</a> that leverages the generic modules, but exposes their functionality in the most simple, homogeneous, and secure way (no need to specify cloud provider credentials, cluster credentials, or filters explicitly; retrieves credentials and stores them in memory only).</p><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">‚Äã</a></h2><p>The name of the package is <code>chaosgarden</code> and it was developed and tested with Python 3.9+. It&#39;s being published to <a href="https://pypi.org/project/chaosgarden" target="_blank" rel="noreferrer">PyPI</a>, so that you can comfortably install it via Python&#39;s package installer <a href="https://pip.pypa.io/en/stable" target="_blank" rel="noreferrer">pip</a> (you may want to <a href="https://packaging.python.org/en/latest/guides/installing-using-pip-and-virtual-environments/#creating-a-virtual-environment" target="_blank" rel="noreferrer">create a virtual environment</a> before installing it):</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chaosgarden</span></span></code></pre></div><p>‚ÑπÔ∏è If you want to use the <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/vsphere" target="_blank" rel="noreferrer">VMware vSphere module</a>, please note the remarks in <a href="https://github.com/gardener/chaos-engineering/blob/main/requirements.txt" target="_blank" rel="noreferrer"><code>requirements.txt</code></a> for <code>vSphere</code>. Those are not contained in the published PyPI package.</p><p>The package can be used directly from Python scripts and supports this usage scenario with additional convenience that helps launch actions and probes in background (more on actions and probes later), so that you can compose also complex scenarios with ease.</p><p>If this technology is new to you, you will probably prefer the <a href="https://chaostoolkit.org" target="_blank" rel="noreferrer"><code>chaostoolkit</code></a> <a href="https://chaostoolkit.org/reference/usage/cli" target="_blank" rel="noreferrer">CLI</a> in combination with <a href="https://chaostoolkit.org/reference/api/experiment" target="_blank" rel="noreferrer">experiment files</a>, so we need to <a href="https://chaostoolkit.org/reference/usage/install/#install-the-cli" target="_blank" rel="noreferrer">install the CLI</a> next:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chaostoolkit</span></span></code></pre></div><p>Please verify that it was installed properly by running:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chaos</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --help</span></span></code></pre></div><h2 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;Usage&quot;">‚Äã</a></h2><p>‚ÑπÔ∏è We assume you are using Gardener and run Gardener-managed shoot clusters. You can also use the generic cloud provider and Kubernetes <code>chaosgarden</code> modules, but configuration and secrets will then differ. Please see the <a href="https://github.com/gardener/chaos-engineering/tree/main/docs" target="_blank" rel="noreferrer">module docs</a> for details.</p><h3 id="a-simple-experiment" tabindex="-1">A Simple Experiment <a class="header-anchor" href="#a-simple-experiment" aria-label="Permalink to &quot;A Simple Experiment&quot;">‚Äã</a></h3><p>The most important command is the <a href="https://chaostoolkit.org/reference/usage/run" target="_blank" rel="noreferrer"><code>run</code></a> command, but before we can use it, we need to compile an experiment file first. Let&#39;s start with a simple one, invoking only a read-only üìñ action from <code>chaosgarden</code> that lists cloud provider machines and networks (depends on cloud provider) for the &quot;first&quot; zone of one of your shoot clusters.</p><p>Let&#39;s assume, your project is called <code>my-project</code> and your shoot is called <code>my-shoot</code>, then we need to create the following experiment:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assess-filters-impact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assess-filters-impact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assess-filters-impact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;provider&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;python&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chaosgarden.garden.actions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;func&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assess_cloud_provider_filters_impact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;arguments&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    &quot;zone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;configuration&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;garden_project&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my-project&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;garden_shoot&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my-shoot&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>We are not yet there and need one more thing to do before we can run it: We need to &quot;target&quot; the Gardener landscape resp. Gardener API server where you have created your shoot cluster (not to be confused with your shoot cluster API server). If you do not know what this is or how to download the Gardener API server <code>kubeconfig</code>, please follow <a href="/docs/dashboard/project-operations/#prerequisites">these instructions</a>. You can either download your <em>personal</em> credentials or <em>project</em> credentials (see <a href="/docs/dashboard/automated-resource-management/#prerequisites">creation of a <code>serviceaccount</code></a>) to interact with Gardener. For now (fastest and most convenient way, but generally not recommended), let&#39;s use your <em>personal</em> credentials, but if you later plan to automate your experiments, please use proper <em>project</em> credentials (a <code>serviceaccount</code> is not bound to your person, but to the project, and can be restricted using <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac" target="_blank" rel="noreferrer">RBAC roles and role bindings</a>, which is why we recommend this for production).</p><p>To download your <em>personal</em> credentials, open the Gardener Dashboard and click on your avatar in the upper right corner of the page. Click &quot;My Account&quot;, then look for the &quot;Access&quot; pane, then &quot;Kubeconfig&quot;, then press the &quot;Download&quot; button and save the <code>kubeconfig</code> to disk. Run the following command next:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KUBECONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">path/to/kubeconfig</span></span></code></pre></div><p>We are now set and you can run your first experiment:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chaos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> path/to/experiment</span></span></code></pre></div><p>You should see output like this (depends on cloud provider):</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[INFO] Validating the experiment&#39;s syntax</span></span>
<span class="line"><span>[INFO] Installing signal handlers to terminate all active background threads on involuntary signals (note that SIGKILL cannot be handled).</span></span>
<span class="line"><span>[INFO] Experiment looks valid</span></span>
<span class="line"><span>[INFO] Running experiment: assess-filters-impact</span></span>
<span class="line"><span>[INFO] Steady-state strategy: default</span></span>
<span class="line"><span>[INFO] Rollbacks strategy: default</span></span>
<span class="line"><span>[INFO] No steady state hypothesis defined. That&#39;s ok, just exploring.</span></span>
<span class="line"><span>[INFO] Playing your experiment&#39;s method now...</span></span>
<span class="line"><span>[INFO] Action: assess-filters-impact</span></span>
<span class="line"><span>[INFO] Validating client credentials and listing probably impacted instances and/or networks with the given arguments zone=&#39;world-1a&#39; and filters={&#39;instances&#39;: [{&#39;Name&#39;: &#39;tag-key&#39;, &#39;Values&#39;: [&#39;kubernetes.io/cluster/shoot--my-project--my-shoot&#39;]}], &#39;vpcs&#39;: [{&#39;Name&#39;: &#39;tag-key&#39;, &#39;Values&#39;: [&#39;kubernetes.io/cluster/shoot--my-project--my-shoot&#39;]}]}:</span></span>
<span class="line"><span>[INFO] 1 instance(s) would be impacted:</span></span>
<span class="line"><span>[INFO] - i-aabbccddeeff0000</span></span>
<span class="line"><span>[INFO] 1 VPC(s) would be impacted:</span></span>
<span class="line"><span>[INFO] - vpc-aabbccddeeff0000</span></span>
<span class="line"><span>[INFO] Let&#39;s rollback...</span></span>
<span class="line"><span>[INFO] No declared rollbacks, let&#39;s move on.</span></span>
<span class="line"><span>[INFO] Experiment ended with status: completed</span></span></code></pre></div><p>üéâ Congratulations! You successfully ran your first <code>chaosgarden</code> experiment.</p><h3 id="a-destructive-experiment" tabindex="-1">A Destructive Experiment <a class="header-anchor" href="#a-destructive-experiment" aria-label="Permalink to &quot;A Destructive Experiment&quot;">‚Äã</a></h3><p>Now let&#39;s break ü™ì your cluster. Be advised that this experiment will be destructive in the sense that we will temporarily network-partition all nodes in one availability zone (machine termination or restart is available with <code>chaosgarden</code> as well). That means, these nodes and their pods won&#39;t be able to &quot;talk&quot; to other nodes, pods, and services. Also, the API server will become unreachable for them and the API server will report them as unreachable (confusingly shown as <code>NotReady</code> when you run <code>kubectl get nodes</code> and <code>Unknown</code> in the status <code>Ready</code> condition when you run <code>kubectl get nodes --output yaml</code>).</p><p>Being unreachable will trigger service endpoint and load balancer de-registration (when the node&#39;s grace period lapses) as well as eventually pod eviction and machine replacement (which will continue to fail under test). We won&#39;t run the experiment long enough for all of these effects to materialize, but the longer you run it, the more will happen, up to temporarily giving up/going into &quot;back-off&quot; for the affected worker pool in that zone. You will also see that the Kubernetes cluster autoscaler will try to create a new machine almost immediately, if pods are pending for the affected zone (which will initially fail under test, but may succeed later, which again depends on the runtime of the experiment and whether or not the cluster autoscaler goes into &quot;back-off&quot; or not).</p><p>But for now, all of this doesn&#39;t matter as we want to start &quot;small&quot;. You can later read up more on the various settings and effects in our <a href="/docs/guides/high-availability/best-practices/">best practices guide on high availability</a>.</p><p>Please create a new experiment file, this time with this content:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;run-network-failure-simulation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;run-network-failure-simulation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;run-network-failure-simulation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;provider&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;python&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chaosgarden.garden.actions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;func&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;run_cloud_provider_network_failure_simulation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;arguments&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;total&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    &quot;zone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    &quot;duration&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;rollbacks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rollback-network-failure-simulation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;provider&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;python&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chaosgarden.garden.actions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;func&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rollback_cloud_provider_network_failure_simulation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                &quot;arguments&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;total&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    &quot;zone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;configuration&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;garden_project&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;env&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GARDEN_PROJECT&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;garden_shoot&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;env&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GARDEN_SHOOT&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>‚ÑπÔ∏è There is an even more destructive action that terminates or alternatively restarts machines in a given zone üî• (immediately or delayed with some randomness/chaos for maximum inconvenience for the nodes and pods). You can find links to all these examples at the end of this tutorial.</p><p>This experiment is very similar, but this time we will break ü™ì your cluster - for <code>60s</code>. If that&#39;s too short to even see a node or pod transition from <code>Ready</code> to <code>NotReady</code> (actually <code>Unknown</code>), then increase the <code>duration</code>. Depending on the workload that your cluster runs, you may already see effects of the network partitioning, because it is effective immediately. It&#39;s just that Kubernetes cannot know immediately and rather assumes that something is failing only <strong>after</strong> the node&#39;s grace period lapses, but the actual workload is impacted immediately.</p><p>Most notably, this experiment also has a <a href="https://chaostoolkit.org/reference/concepts/#rollbacks" target="_blank" rel="noreferrer"><code>rollbacks</code></a> section, which is invoked even if you abort the experiment or it fails unexpectedly, but only if you run the CLI with the option <code>--rollback-strategy always</code> which we will do soon. Any <code>chaosgarden</code> action that can undo its activity, will do that implicitly when the <code>duration</code> lapses, but it is a best practice to always configure a <code>rollbacks</code> section in case something unexpected happens. Should you be in panic and just want to run the <code>rollbacks</code> section, you can remove all other actions and the CLI will execute the <code>rollbacks</code> section immediately.</p><p>One other thing is different in the second experiment as well. We now read the name of the project and the shoot from the environment, i.e. a <a href="https://chaostoolkit.org/reference/api/experiment/#configuration" target="_blank" rel="noreferrer"><code>configuration</code></a> section can automatically expand <a href="https://chaostoolkit.org/reference/api/experiment/#environment-configurations" target="_blank" rel="noreferrer">environment variables</a>. Also useful to know (not shown here), <code>chaostoolkit</code> supports <a href="https://chaostoolkit.org/reference/api/experiment/#variable-substitution" target="_blank" rel="noreferrer">variable substitution</a> too, so that you have to define variables only once. Please note that you can also add a <a href="https://chaostoolkit.org/reference/api/experiment/#secrets" target="_blank" rel="noreferrer"><code>secrets</code></a> section that can also automatically expand <a href="https://chaostoolkit.org/reference/api/experiment/#environment-secrets" target="_blank" rel="noreferrer">environment variables</a>. For instance, instead of targeting the Gardener API server via <code>$KUBECONFIG</code>, which is supported by our <code>chaosgarden</code> package natively, you can also explicitly refer to it in a <code>secrets</code> section (for brevity reasons not shown here either).</p><p>Let&#39;s now run your second experiment (please watch your nodes and pods in parallel, e.g. by running <code>watch kubectl get nodes,pods --output wide</code> in another terminal):</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GARDEN_PROJECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">my-project</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GARDEN_SHOOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">my-shoot</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chaos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rollback-strategy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> always</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> path/to/experiment</span></span></code></pre></div><p>The output of the <code>run</code> command will be similar to the one above, but longer. It will mention either machines or networks that were network-partitioned (depends on cloud provider), but should revert everything back to normal.</p><p>Normally, you would not only run <a href="https://chaostoolkit.org/reference/concepts/#actions" target="_blank" rel="noreferrer">actions</a> in the <code>method</code> section, but also <a href="https://chaostoolkit.org/reference/concepts/#probes" target="_blank" rel="noreferrer">probes</a> as part of a <a href="https://chaostoolkit.org/reference/concepts/#steady-state-hypothesis" target="_blank" rel="noreferrer">steady state hypothesis</a>. Such steady state hypothesis probes are run before and after the actions to validate that the &quot;system&quot; was in a healthy state before and gets back to a healthy state after the actions ran, hence show that the &quot;system&quot; is in a steady state when not under test. Eventually, you will write your own probes that don&#39;t even have to be part of a steady state hypothesis. We at Gardener run multi-zone (multiple zones at once) and rolling-zone (strike each zone once) outages with continuous custom probes all within the <code>method</code> section to validate our KPIs continuously under test (e.g. how long do the individual fail-overs take/how long is the actual outage). The most complex scenarios are even run via Python scripts as all actions and probes can also be invoked directly (which is what the CLI does).</p><h2 id="high-availability" tabindex="-1">High Availability <a class="header-anchor" href="#high-availability" aria-label="Permalink to &quot;High Availability&quot;">‚Äã</a></h2><p>Developing highly available workload that can tolerate a zone outage is no trivial task. You can find more information on how to achieve this goal in our <a href="/docs/guides/high-availability/best-practices/">best practices guide on high availability</a>.</p><p>Thank you for your interest in Gardener chaos engineering and making your workload more resilient.</p><h2 id="further-reading" tabindex="-1">Further Reading <a class="header-anchor" href="#further-reading" aria-label="Permalink to &quot;Further Reading&quot;">‚Äã</a></h2><p>Here some links for further reading:</p><ul><li><strong>Examples</strong>: <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/tutorials/experiments" target="_blank" rel="noreferrer">Experiments</a>, <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/tutorials/scripts" target="_blank" rel="noreferrer">Scripts</a></li><li><strong>Gardener Chaos Engineering</strong>: <a href="https://github.com/gardener/chaos-engineering" target="_blank" rel="noreferrer">GitHub</a>, <a href="https://pypi.org/project/chaosgarden" target="_blank" rel="noreferrer">PyPI</a>, <a href="https://github.com/gardener/chaos-engineering/tree/main/docs/garden" target="_blank" rel="noreferrer">Module Docs for Gardener Users</a></li><li><strong>Chaos Toolkit Core</strong>: <a href="https://chaostoolkit.org" target="_blank" rel="noreferrer">Home Page</a>, <a href="https://chaostoolkit.org/reference/usage/install" target="_blank" rel="noreferrer">Installation</a>, <a href="https://chaostoolkit.org/reference/concepts" target="_blank" rel="noreferrer">Concepts</a>, <a href="https://github.com/chaostoolkit/chaostoolkit" target="_blank" rel="noreferrer">GitHub</a></li></ul>`,47)]))}const u=e(n,[["render",o]]);export{c as __pageData,u as default};
