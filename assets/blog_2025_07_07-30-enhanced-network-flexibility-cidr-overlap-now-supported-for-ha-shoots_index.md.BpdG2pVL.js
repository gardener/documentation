import{_ as o,c as t,o as r,a2 as n}from"./chunks/framework.Bfq10Vlj.js";const u=JSON.parse('{"title":"Enhanced Network Flexibility: CIDR Overlap Now Supported for HA Shoots","description":"","frontmatter":{"aliases":["/blog/2025/07/30/enhanced-network-flexibility-cidr-overlap-now-supported-for-ha-shoots"],"authors":[{"avatar":"https://avatars.githubusercontent.com/domdom82","email":"Dominik.Froehlich@sap.com","login":"domdom82","name":"Dominik Froehlich"}],"github_repo":"https://github.com/gardener/documentation","github_subdir":"website/blog/2025/07","linkTitle":"Enhanced Network Flexibility: CIDR Overlap Now Supported for HA Shoots","newsSubtitle":"July 30, 2025","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/blog/2025/07/07-30-enhanced-network-flexibility-cidr-overlap-now-supported-for-ha-shoots.md","to":"07-30-enhanced-network-flexibility-cidr-overlap-now-supported-for-ha-shoots.md"},"publishdate":"2025-07-30","title":"Enhanced Network Flexibility: CIDR Overlap Now Supported for HA Shoots"},"headers":[],"relativePath":"blog/2025/07/07-30-enhanced-network-flexibility-cidr-overlap-now-supported-for-ha-shoots/index.md","filePath":"blog/2025/07/07-30-enhanced-network-flexibility-cidr-overlap-now-supported-for-ha-shoots.md","lastUpdated":null}'),a={name:"blog/2025/07/07-30-enhanced-network-flexibility-cidr-overlap-now-supported-for-ha-shoots/index.md"};function i(s,e,l,h,d,c){return r(),t("div",null,e[0]||(e[0]=[n('<h1 id="enhanced-network-flexibility-cidr-overlap-now-supported-for-ha-shoots" tabindex="-1">Enhanced Network Flexibility: CIDR Overlap Now Supported for HA Shoots <a class="header-anchor" href="#enhanced-network-flexibility-cidr-overlap-now-supported-for-ha-shoots" aria-label="Permalink to &quot;Enhanced Network Flexibility: CIDR Overlap Now Supported for HA Shoots&quot;">​</a></h1><p>Gardener continues to enhance its networking capabilities, offering users greater flexibility in managing their cluster landscapes. A significant advancement is the extension of IPv4 network overlap support to Shoot clusters with high-availability (HA) control planes. Previously a feature exclusive to non-HA Shoots, this update allows both single-stack IPv4 and dual-stack Shoots to utilize pod, service, and node network ranges that overlap with the networks of their Seed cluster.</p><h3 id="disentangling-networks-with-double-nat" tabindex="-1">Disentangling Networks with Double NAT <a class="header-anchor" href="#disentangling-networks-with-double-nat" aria-label="Permalink to &quot;Disentangling Networks with Double NAT&quot;">​</a></h3><p>The challenge of overlapping IP addresses between a Seed and a Shoot is solved through a clever implementation of double Network Address Translation (NAT) within the VPN connection. When Gardener detects an overlap between a Shoot&#39;s IPv4 networks and the Seed&#39;s pod network, it dynamically reconfigures the networking stack to ensure seamless, conflict-free communication.</p><p>For HA Shoots, this is achieved by conditionally injecting an Envoy proxy as a sidecar container into the <code>kube-apiserver</code> pod. The <code>kube-apiserver</code> is then configured with an egress selector to direct all traffic destined for the Shoot through this local Envoy proxy.</p><p>This isolation allows Gardener to apply a set of <code>iptables</code> rules that perform the double NAT:</p><ol><li><strong>Source NAT (SNAT):</strong> The source IP of the <code>kube-apiserver</code> pod is translated.</li><li><strong>Destination NAT (DNAT):</strong> The destination IP addresses for the Shoot&#39;s pods, services, and nodes are translated to a reserved, non-routable IP range (<code>240.0.0.0/4</code>).</li></ol><p>This entire translation process is contained within the VPN tunnel and is reversed on the Shoot side, ensuring that the overlapping addresses never cause routing conflicts in either the Seed or the Shoot cluster.</p><h3 id="a-conditional-and-efficient-approach" tabindex="-1">A Conditional and Efficient Approach <a class="header-anchor" href="#a-conditional-and-efficient-approach" aria-label="Permalink to &quot;A Conditional and Efficient Approach&quot;">​</a></h3><p>To maintain efficiency and minimize resource consumption, the Envoy proxy and its associated networking rules are only deployed when an actual CIDR overlap is present. For HA Shoots that do not have overlapping networks with their Seed, the <code>kube-apiserver</code> deployment remains unchanged. This conditional approach ensures that there is no performance or resource overhead for clusters that do not require this feature, while providing maximum flexibility for those that do.</p><p>This enhancement removes a key networking constraint for HA clusters, simplifying IP address management in complex or IP-constrained environments.</p><h3 id="further-information" tabindex="-1">Further Information <a class="header-anchor" href="#further-information" aria-label="Permalink to &quot;Further Information&quot;">​</a></h3><ul><li><strong>Watch the presentation:</strong> <a href="https://youtu.be/xYiWsIQ8n1o?t=1092" target="_blank" rel="noreferrer">CIDR Overlap w/ Seed For HA Shoots</a></li><li><strong>GitHub Pull Request:</strong> <a href="https://github.com/gardener/gardener/pull/12204" target="_blank" rel="noreferrer">feat: Allow CIDR overlap for HA VPN shoots #12204</a></li><li><strong>Documentation:</strong> <a href="/docs/gardener/networking/shoot_networking/#overlapping-ipv4-networks-between-seed-and-shoot">Overlapping IPv4 Networks between Seed and Shoot</a></li></ul>',13)]))}const f=o(a,[["render",i]]);export{u as __pageData,f as default};
