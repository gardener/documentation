import{_ as t,c as i,o as a,a2 as s}from"./chunks/framework.Bfq10Vlj.js";const k=JSON.parse('{"title":"Trigger Shoot Operations Through Annotations","description":"","frontmatter":{"aliases":["/docs/gardener/shoot_operations/"],"github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/usage/shoot-operations","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/shoot-operations/shoot_operations.md","to":"shoot_operations.md"},"persona":"Users","title":"Trigger Shoot Operations Through Annotations","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/shoot-operations/shoot_operations/index.md","filePath":"docs/gardener/shoot-operations/shoot_operations.md","lastUpdated":null}'),o={name:"docs/gardener/shoot-operations/shoot_operations/index.md"};function n(r,e,l,h,d,c){return a(),i("div",null,e[0]||(e[0]=[s('<h1 id="trigger-shoot-operations-through-annotations" tabindex="-1">Trigger Shoot Operations Through Annotations <a class="header-anchor" href="#trigger-shoot-operations-through-annotations" aria-label="Permalink to &quot;Trigger Shoot Operations Through Annotations&quot;">​</a></h1><p>You can trigger a few explicit operations by annotating the <code>Shoot</code> with an operation annotation. This might allow you to induct certain behavior without the need to change the <code>Shoot</code> specification. Some of the operations can also not be caused by changing something in the shoot specification because they can&#39;t properly be reflected here. Note that once the triggered operation is considered by the controllers, the annotation will be automatically removed and you have to add it each time you want to trigger the operation.</p><p>Please note: If <code>.spec.maintenance.confineSpecUpdateRollout=true</code>, then the only way to trigger a shoot reconciliation is by setting the <code>reconcile</code> operation, see below.</p><h2 id="immediate-reconciliation" tabindex="-1">Immediate Reconciliation <a class="header-anchor" href="#immediate-reconciliation" aria-label="Permalink to &quot;Immediate Reconciliation&quot;">​</a></h2><p>Annotate the shoot with <code>gardener.cloud/operation=reconcile</code> to make the <code>gardenlet</code> start a reconciliation operation without changing the shoot spec and possibly without being in its maintenance time window:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> garden-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shoot-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener.cloud/operation=reconcile</span></span></code></pre></div><h2 id="immediate-maintenance" tabindex="-1">Immediate Maintenance <a class="header-anchor" href="#immediate-maintenance" aria-label="Permalink to &quot;Immediate Maintenance&quot;">​</a></h2><p>Annotate the shoot with <code>gardener.cloud/operation=maintain</code> to make the <code>gardener-controller-manager</code> start maintaining your shoot immediately (possibly without being in its maintenance time window). If no reconciliation starts, then nothing needs to be maintained:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> garden-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shoot-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener.cloud/operation=maintain</span></span></code></pre></div><h2 id="retry-failed-reconciliation" tabindex="-1">Retry Failed Reconciliation <a class="header-anchor" href="#retry-failed-reconciliation" aria-label="Permalink to &quot;Retry Failed Reconciliation&quot;">​</a></h2><p>Annotate the shoot with <code>gardener.cloud/operation=retry</code> to make the <code>gardenlet</code> start a new reconciliation loop on a failed shoot. Failed shoots are only reconciled again if a new Gardener version is deployed, the shoot specification is changed or this annotation is set:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> garden-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shoot-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener.cloud/operation=retry</span></span></code></pre></div><h2 id="force-update-a-worker-pool-with-inplace-update-strategy" tabindex="-1">Force-update a worker pool with InPlace update strategy <a class="header-anchor" href="#force-update-a-worker-pool-with-inplace-update-strategy" aria-label="Permalink to &quot;Force-update a worker pool with InPlace update strategy&quot;">​</a></h2><p>Annotate the shoot with <code>gardener.cloud/operation=force-in-place-update</code> to force an update for worker pools using the update strategy <code>AutoInPlaceUpdate</code> or <code>ManualInPlaceUpdate</code>. Without this annotation, any subsequent updates to the same worker pool are denied until the <code>Shoot</code> has been successfully reconciled following the current in-place update.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> garden-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shoot-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener.cloud/operation=force-in-place-update</span></span></code></pre></div><h2 id="credentials-rotation-operations" tabindex="-1">Credentials Rotation Operations <a class="header-anchor" href="#credentials-rotation-operations" aria-label="Permalink to &quot;Credentials Rotation Operations&quot;">​</a></h2><p>Please consult <a href="/docs/gardener/shoot-operations/shoot_credentials_rotation/">Credentials Rotation for Shoot Clusters</a> for more information.</p><h2 id="restart-systemd-services-on-particular-worker-nodes" tabindex="-1">Restart <code>systemd</code> Services on Particular Worker Nodes <a class="header-anchor" href="#restart-systemd-services-on-particular-worker-nodes" aria-label="Permalink to &quot;Restart `systemd` Services on Particular Worker Nodes&quot;">​</a></h2><p>It is possible to make Gardener restart particular systemd services on your shoot worker nodes if needed. The annotation is not set on the <code>Shoot</code> resource but directly on the <code>Node</code> object you want to target. For example, the following will restart both the <code>kubelet</code> and the <code>containerd</code> services:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> worker.gardener.cloud/restart-systemd-services=kubelet,containerd</span></span></code></pre></div><p>It may take up to a minute until the service is restarted. The annotation will be removed from the <code>Node</code> object after all specified systemd services have been restarted. It will also be removed even if the restart of one or more services failed.</p><blockquote><p>ℹ️ In the example mentioned above, you could additionally verify when/whether the kubelet restarted by using <code>kubectl describe node &lt;node-name&gt;</code> and looking for such a <code>Starting kubelet</code> event.</p></blockquote><h2 id="running-operations-in-parallel" tabindex="-1">Running Operations In Parallel <a class="header-anchor" href="#running-operations-in-parallel" aria-label="Permalink to &quot;Running Operations In Parallel&quot;">​</a></h2><p>Specific <code>Shoot</code> operations can run in parallel by using <code>;</code> as separator.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> garden-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shoot-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener.cloud/operation=&quot;rotate-ssh-keypair;rotate-ca-start&quot;</span></span></code></pre></div><p>List of operations that can run in parallel:</p><ul><li><code>reconcile</code></li><li><code>rotate-ca-start</code></li><li><code>rotate-ca-start-without-workers-rollout</code></li><li><code>rotate-ca-complete</code></li><li><code>rotate-observability-credentials</code></li><li><code>rotate-ssh-keypair</code></li><li><code>rotate-rollout-workers</code></li><li><code>rotate-credentials-start</code></li><li><code>rotate-credentials-start-without-workers-rollout</code></li><li><code>rotate-credentials-complete</code></li><li><code>rotate-etcd-encryption-key</code></li><li><code>rotate-etcd-encryption-key-start</code></li><li><code>rotate-etcd-encryption-key-complete</code></li><li><code>rotate-serviceaccount-key-start</code></li><li><code>rotate-serviceaccount-key-start-without-workers-rollout</code></li><li><code>rotate-serviceaccount-key-complete</code></li></ul><h2 id="force-deletion" tabindex="-1">Force Deletion <a class="header-anchor" href="#force-deletion" aria-label="Permalink to &quot;Force Deletion&quot;">​</a></h2><p>When a Shoot fails to be deleted normally, users can force-delete the Shoot if it meets the following conditions:</p><ul><li>Shoot has a deletion timestamp.</li><li>Shoot status contains at least one of the following <a href="/docs/gardener/shoot/shoot_status/#error-codes">ErrorCodes</a>: <ul><li><code>ERR_CLEANUP_CLUSTER_RESOURCES</code></li><li><code>ERR_CONFIGURATION_PROBLEM</code></li><li><code>ERR_INFRA_DEPENDENCIES</code></li><li><code>ERR_INFRA_UNAUTHENTICATED</code></li><li><code>ERR_INFRA_UNAUTHORIZED</code></li></ul></li></ul><p>If the above conditions are satisfied, you can annotate the Shoot with <code>confirmation.gardener.cloud/force-deletion=true</code>, and Gardener will cleanup the Shoot controlplane and the Shoot metadata.</p><blockquote><p>⚠️ You <strong>MUST</strong> ensure that all the resources created in the IaaS account are cleaned up to prevent orphaned resources. Gardener will <strong>NOT</strong> delete any resources in the underlying infrastructure account. Hence, use this annotation at your own risk and only if you are fully aware of these consequences.</p></blockquote>',32)]))}const g=t(o,[["render",n]]);export{k as __pageData,g as default};
