import{_ as o,c as t,o as a,a2 as r}from"./chunks/framework.Bfq10Vlj.js";const p=JSON.parse('{"title":"APIServer Admission Plugins","description":"A list of all gardener managed admission plugins together with their responsibilities","frontmatter":{"description":"A list of all gardener managed admission plugins together with their responsibilities","github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/concepts","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/concepts/apiserver-admission-plugins.md","to":"apiserver-admission-plugins.md"},"title":"APIServer Admission Plugins","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/concepts/apiserver-admission-plugins/index.md","filePath":"docs/gardener/concepts/apiserver-admission-plugins.md","lastUpdated":null}'),s={name:"docs/gardener/concepts/apiserver-admission-plugins/index.md"};function i(n,e,d,c,l,h){return a(),t("div",null,e[0]||(e[0]=[r('<h1 id="apiserver-admission-plugins" tabindex="-1">APIServer Admission Plugins <a class="header-anchor" href="#apiserver-admission-plugins" aria-label="Permalink to &quot;APIServer Admission Plugins&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Similar to the kube-apiserver, the gardener-apiserver comes with a few in-tree managed admission plugins. If you want to get an overview of the what and why of admission plugins then <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/" target="_blank" rel="noreferrer">this document</a> might be a good start.</p><p>This document lists all existing admission plugins with a short explanation of what it is responsible for.</p><h2 id="backupbucketvalidator" tabindex="-1"><code>BackupBucketValidator</code> <a class="header-anchor" href="#backupbucketvalidator" aria-label="Permalink to &quot;`BackupBucketValidator`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>BackupBuckets</code>s. When the backup bucket is using <code>WorkloadIdentity</code> as backup credentials, the plugin ensures the backup bucket and the workload identity have the same provider type, i.e. <code>backupBucket.spec.provider.type</code> and <code>workloadIdentity.spec.targetSystem.type</code> have the same value.</p><h2 id="bastion" tabindex="-1"><code>Bastion</code> <a class="header-anchor" href="#bastion" aria-label="Permalink to &quot;`Bastion`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>Bastion</code>s.</p><p>It validates that the <code>Shoot</code> referenced in the <code>Bastion</code>:</p><ul><li>is not in deletion.</li><li>is assigned to a <code>Seed</code>.</li><li>does not disable SSH access for the worker Nodes.</li></ul><p>It mutates the <code>Bastion</code> in the following way:</p><ul><li>it sets<code>.spec.seedName</code> to the <code>Shoot</code> <code>.spec.seedName</code>.</li><li>it sets <code>.spec.providerType</code> to the <code>Shoot</code> <code>.spec.provider.type</code>.</li><li>it sets the <code>gardener.cloud/created-by=&lt;username&gt;</code> annotation for <code>CREATE</code> operations.</li><li>it adds an owner reference to the <code>Shoot</code> to ensure the <code>Bastion</code> is deleted when the <code>Shoot</code> is deleted.</li></ul><h2 id="clusteropenidconnectpreset-openidconnectpreset" tabindex="-1"><code>ClusterOpenIDConnectPreset</code>, <code>OpenIDConnectPreset</code> <a class="header-anchor" href="#clusteropenidconnectpreset-openidconnectpreset" aria-label="Permalink to &quot;`ClusterOpenIDConnectPreset`, `OpenIDConnectPreset`&quot;">​</a></h2><p><strong>Type</strong>: Mutating (for both). <strong>Enabled by default</strong>: Yes (for both).</p><p>These admission controllers react on <code>CREATE</code> operations for <code>Shoot</code>s. If the <code>Shoot</code> does not specify any OIDC configuration (<code>.spec.kubernetes.kubeAPIServer.oidcConfig=nil</code>), then it tries to find a matching <code>ClusterOpenIDConnectPreset</code> or <code>OpenIDConnectPreset</code>, respectively. If there are multiple matches, then the one with the highest weight &quot;wins&quot;. In this case, the admission controller will default the OIDC configuration in the <code>Shoot</code>.</p><h2 id="controllerregistrationresources" tabindex="-1"><code>ControllerRegistrationResources</code> <a class="header-anchor" href="#controllerregistrationresources" aria-label="Permalink to &quot;`ControllerRegistrationResources`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>ControllerRegistration</code>s. It validates that there exists only one <code>ControllerRegistration</code> in the system that is primarily responsible for a given kind/type resource combination. This prevents misconfiguration by the Gardener administrator/operator.</p><h2 id="customverbauthorizer" tabindex="-1"><code>CustomVerbAuthorizer</code> <a class="header-anchor" href="#customverbauthorizer" aria-label="Permalink to &quot;`CustomVerbAuthorizer`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>Project</code>s and <code>NamespacedCloudProfile</code>s.</p><p>For <code>Project</code>s it validates whether the user is bound to an RBAC role with the <code>modify-spec-tolerations-whitelist</code> verb in case the user tries to change the <code>.spec.tolerations.whitelist</code> field of the respective <code>Project</code> resource. Usually, regular project members are not bound to this custom verb, allowing the Gardener administrator to manage certain toleration whitelists on <code>Project</code> basis.</p><p>For <code>NamespacedCloudProfile</code>s, the modification of specific fields also require the user to be bound to an RBAC role with custom verbs. Please see <a href="/docs/gardener/project/namespaced-cloud-profiles/#field-modification-restrictions">this document</a> for more information.</p><p>For <code>Shoot</code>s, the <code>mark-self-hosted</code> verb is required to set the <code>spec.provider.workers[].controlPlane</code> field (which marks a <code>Shoot</code> as &quot;self-hosted shoot&quot;).</p><h2 id="deletionconfirmation" tabindex="-1"><code>DeletionConfirmation</code> <a class="header-anchor" href="#deletionconfirmation" aria-label="Permalink to &quot;`DeletionConfirmation`&quot;">​</a></h2><p><strong>Type</strong>: Validating and Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>DELETE</code> operations for <code>Project</code>s, <code>Shoot</code>s, and <code>ShootState</code>s. It validates that the respective resource is annotated with a deletion confirmation annotation, namely <code>confirmation.gardener.cloud/deletion=true</code>. Only if this annotation is present it allows the <code>DELETE</code> operation to pass. This prevents users from accidental/undesired deletions. In addition, it applies the &quot;four-eyes principle for deletion&quot; concept if the <code>Project</code> is configured accordingly. Find all information about it <a href="/docs/gardener/project/projects/#four-eyes-principle-for-resource-deletion">in this document</a>.</p><p>Furthermore, this admission controller reacts on <code>CREATE</code> or <code>UPDATE</code> operations for <code>Shoot</code>s. It makes sure that the <code>deletion.gardener.cloud/confirmed-by</code> annotation is properly maintained in case the <code>Shoot</code> deletion is confirmed with above mentioned annotation.</p><h2 id="extensionlabels" tabindex="-1"><code>ExtensionLabels</code> <a class="header-anchor" href="#extensionlabels" aria-label="Permalink to &quot;`ExtensionLabels`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>BackupBucket</code>s, <code>BackupEntry</code>s, <code>CloudProfile</code>s, <code>NamespacedCloudProfile</code>s, <code>Seed</code>s, <code>SecretBinding</code>s, <code>CredentialsBinding</code>s, <code>WorkloadIdentity</code>s and <code>Shoot</code>s. For all the various extension types in the specifications of these objects, it adds a corresponding label in the resource. This would allow extension admission webhooks to filter out the resources they are responsible for and ignore all others. This label is of the form <code>&lt;extension-type&gt;.extensions.gardener.cloud/&lt;extension-name&gt; : &quot;true&quot;</code>. For example, an extension label for provider extension type <code>aws</code>, looks like <code>provider.extensions.gardener.cloud/aws : &quot;true&quot;</code>.</p><h2 id="extensionvalidator" tabindex="-1"><code>ExtensionValidator</code> <a class="header-anchor" href="#extensionvalidator" aria-label="Permalink to &quot;`ExtensionValidator`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>BackupEntry</code>s, <code>BackupBucket</code>s, <code>Seed</code>s, and <code>Shoot</code>s. For all the various extension types in the specifications of these objects, it validates whether there exists a <code>ControllerRegistration</code> in the system that is primarily responsible for the stated extension type(s). This prevents misconfigurations that would otherwise allow users to create such resources with extension types that don&#39;t exist in the cluster, effectively leading to failing reconciliation loops.</p><h2 id="finalizerremoval" tabindex="-1"><code>FinalizerRemoval</code> <a class="header-anchor" href="#finalizerremoval" aria-label="Permalink to &quot;`FinalizerRemoval`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>UPDATE</code> operations for <code>CredentialsBinding</code>s, <code>SecretBinding</code>s, <code>Shoot</code>s. It ensures that the finalizers of these resources are not removed by users, as long as the affected resource is still in use. For <code>CredentialsBinding</code>s and <code>SecretBinding</code>s this means, that the <code>gardener</code> finalizer can only be removed if the binding is not referenced by any <code>Shoot</code>. In case of <code>Shoot</code>s, the <code>gardener</code> finalizer can only be removed if the last operation of the <code>Shoot</code> indicates a successful deletion.</p><h2 id="managedseed" tabindex="-1"><code>ManagedSeed</code> <a class="header-anchor" href="#managedseed" aria-label="Permalink to &quot;`ManagedSeed`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>ManagedSeeds</code>s. It validates certain configuration values in the specification against the referred <code>Shoot</code>, for example Seed provider, network ranges, DNS domain, etc. Similar to <code>ShootValidator</code>, it performs validations that cannot be handled by the static API validation due to their dynamic nature. Additionally, it performs certain defaulting tasks, making sure that configuration values that are not specified are defaulted to the values of the referred <code>Shoot</code>, for example Seed provider, network ranges, DNS domain, etc.</p><h2 id="managedseedshoot" tabindex="-1"><code>ManagedSeedShoot</code> <a class="header-anchor" href="#managedseedshoot" aria-label="Permalink to &quot;`ManagedSeedShoot`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>DELETE</code> operations for <code>ManagedSeed</code>s. It rejects the deletion if there are <code>Shoot</code>s that are scheduled onto the <code>Seed</code> that is registered by the <code>ManagedSeed</code>.</p><h2 id="mutatingadmissionpolicy" tabindex="-1"><code>MutatingAdmissionPolicy</code> <a class="header-anchor" href="#mutatingadmissionpolicy" aria-label="Permalink to &quot;`MutatingAdmissionPolicy`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: No.</p><p>This admission controller is defined in the generic API server library (<code>k8s.io/apiserver</code>). See the <a href="https://kubernetes.io/docs/reference/access-authn-authz/mutating-admission-policy" target="_blank" rel="noreferrer">Mutating Admission Policy page</a>.</p><h2 id="mutatingadmissionwebhook" tabindex="-1"><code>MutatingAdmissionWebhook</code> <a class="header-anchor" href="#mutatingadmissionwebhook" aria-label="Permalink to &quot;`MutatingAdmissionWebhook`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller is defined in the generic API server library (<code>k8s.io/apiserver</code>). See the <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#mutatingadmissionwebhook" target="_blank" rel="noreferrer">MutatingAdmissionWebhook section</a>.</p><h2 id="namespacelifecycle" tabindex="-1"><code>NamespaceLifecycle</code> <a class="header-anchor" href="#namespacelifecycle" aria-label="Permalink to &quot;`NamespaceLifecycle`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller is defined in the generic API server library (<code>k8s.io/apiserver</code>). See the <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#namespacelifecycle" target="_blank" rel="noreferrer">NamespaceLifecycle section</a>.</p><h2 id="namespacedcloudprofilevalidator" tabindex="-1"><code>NamespacedCloudProfileValidator</code> <a class="header-anchor" href="#namespacedcloudprofilevalidator" aria-label="Permalink to &quot;`NamespacedCloudProfileValidator`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>NamespacedCloudProfile</code>s. It primarily validates if the referenced parent <code>CloudProfile</code> exists in the system. In addition, the admission controller ensures that the <code>NamespacedCloudProfile</code> only configures new machine types, and does not overwrite those from the parent <code>CloudProfile</code>.</p><h2 id="projectmutator" tabindex="-1"><code>ProjectMutator</code> <a class="header-anchor" href="#projectmutator" aria-label="Permalink to &quot;`ProjectMutator`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>Project</code>s.</p><p>When the project specification is initialized during creation:</p><ul><li><code>.spec.createdBy</code> is set to the user creating the project.</li><li><code>.spec.owner</code> defaults to the value of <code>.spec.createdBy</code> if it is not specified.</li></ul><p>During subsequent updates, it ensures that the project owner is included in the <code>.spec.members</code> list.</p><h2 id="resourcequota" tabindex="-1"><code>ResourceQuota</code> <a class="header-anchor" href="#resourcequota" aria-label="Permalink to &quot;`ResourceQuota`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller is defined in the generic API server library (<code>k8s.io/apiserver</code>). See the <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#resourcequota" target="_blank" rel="noreferrer">ResourceQuota section</a>.</p><p>This admission controller enables <a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/#object-count-quota" target="_blank" rel="noreferrer">object count ResourceQuotas</a> for Gardener resources, e.g. <code>Shoots</code>, <code>SecretBindings</code>, <code>Projects</code>, etc.</p><blockquote><p>⚠️ In addition to this admission plugin, the <a href="https://github.com/kubernetes/kubernetes/blob/release-1.2/docs/design/admission_control_resource_quota.md#resource-quota-controller" target="_blank" rel="noreferrer">ResourceQuota controller</a> must be enabled for the Kube-Controller-Manager of your Garden cluster.</p></blockquote><h2 id="resourcereferencemanager" tabindex="-1"><code>ResourceReferenceManager</code> <a class="header-anchor" href="#resourcereferencemanager" aria-label="Permalink to &quot;`ResourceReferenceManager`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>CloudProfile</code>s, <code>Project</code>s, <code>SecretBinding</code>s, <code>Seed</code>s, and <code>Shoot</code>s. Generally, it checks whether referred resources stated in the specifications of these objects exist in the system (e.g., if a referenced <code>Secret</code> exists).</p><p>However, it also has some special behaviours for certain resources:</p><ul><li><code>CloudProfile</code>s: It rejects removing Kubernetes or machine image versions if there is at least one <code>Shoot</code> that refers to them.</li></ul><h2 id="seedmutator" tabindex="-1"><code>SeedMutator</code> <a class="header-anchor" href="#seedmutator" aria-label="Permalink to &quot;`SeedMutator`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>Seed</code>s. It maintains the <code>name.seed.gardener.cloud/&lt;name&gt;</code> labels for it. More specifically, it adds that the <code>name.seed.gardener.cloud/&lt;name&gt;=true</code> label where <code>&lt;name&gt;</code> is</p><ul><li>the name of the <code>Seed</code> resource (a <code>Seed</code> named <code>foo</code> will get label <code>name.seed.gardener.cloud/foo=true</code>).</li><li>the name of the parent <code>Seed</code> resource in case it is a <code>ManagedSeed</code> (a <code>Seed</code> named <code>foo</code> that is created by a <code>ManagedSeed</code> which references a <code>Shoot</code> running a <code>Seed</code> called <code>bar</code> will get label <code>name.seed.gardener.cloud/bar=true</code>).</li></ul><h2 id="seedvalidator" tabindex="-1"><code>SeedValidator</code> <a class="header-anchor" href="#seedvalidator" aria-label="Permalink to &quot;`SeedValidator`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code>, <code>UPDATE</code>, and <code>DELETE</code> operations for <code>Seed</code>s. Rejects the deletion if <code>Shoot</code>(s) reference the seed cluster. While the seed is still used by <code>Shoot</code>(s), the plugin disallows removal of entries from the <code>seed.spec.provider.zones</code> field. When the seed is using <code>WorkloadIdentity</code> as backup credentials, the plugin ensures the seed backup and the workload identity have the same provider type, i.e. <code>seed.spec.backup.provider</code> and <code>workloadIdentity.spec.targetSystem.type</code> have the same value.</p><h2 id="shootdns" tabindex="-1"><code>ShootDNS</code> <a class="header-anchor" href="#shootdns" aria-label="Permalink to &quot;`ShootDNS`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>Shoot</code>s. It tries to assign a default domain to the <code>Shoot</code>. It also validates the DNS configuration (<code>.spec.dns</code>) for shoots.</p><h2 id="shootdnsrewriting" tabindex="-1"><code>ShootDNSRewriting</code> <a class="header-anchor" href="#shootdnsrewriting" aria-label="Permalink to &quot;`ShootDNSRewriting`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: No.</p><p>This admission controller reacts on <code>CREATE</code> operations for <code>Shoot</code>s. If enabled, it adds a set of common suffixes configured in its admission plugin configuration to the <code>Shoot</code> (<code>spec.systemComponents.coreDNS.rewriting.commonSuffixes</code>) (for more information, see <a href="/docs/gardener/networking/dns-search-path-optimization/">DNS Search Path Optimization</a>). Already existing <code>Shoot</code>s will not be affected by this admission plugin.</p><h2 id="shootexposureclass" tabindex="-1"><code>ShootExposureClass</code> <a class="header-anchor" href="#shootexposureclass" aria-label="Permalink to &quot;`ShootExposureClass`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>Create</code> operations for <code>Shoot</code>s. It mutates <code>Shoot</code> resources which have an <code>ExposureClass</code> referenced by merging both their <code>shootSelectors</code> and/or <code>tolerations</code> into the <code>Shoot</code> resource.</p><h2 id="shootmanagedseed" tabindex="-1"><code>ShootManagedSeed</code> <a class="header-anchor" href="#shootmanagedseed" aria-label="Permalink to &quot;`ShootManagedSeed`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>UPDATE</code> and <code>DELETE</code> operations for <code>Shoot</code>s. It validates certain configuration values in the specification that are specific to <code>ManagedSeed</code>s (e.g. the nginx-addon of the Shoot has to be disabled, the Shoot VPA has to be enabled). It rejects the deletion if the <code>Shoot</code> is referred to by a <code>ManagedSeed</code>.</p><h2 id="shootmutator" tabindex="-1"><code>ShootMutator</code> <a class="header-anchor" href="#shootmutator" aria-label="Permalink to &quot;`ShootMutator`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>Shoot</code>s.</p><p>It mutates the <code>Shoot</code> in the following way:</p><ul><li>It sets the <code>gardener.cloud/created-by=&lt;username&gt;</code> annotation for newly created <code>Shoot</code> resources.</li><li>It maintains annotations used for Shoot lifecycle operations such as <code>shoot.gardener.cloud/tasks</code> and <code>maintenance.shoot.gardener.cloud/needs-retry-operation</code>.</li><li>It defaults Shoot <code>.spec.networking.pods</code> and <code>.spec.networking.services</code> fields in case they are not provided and the Seed specifies the <code>.spec.networks.shootDefaults</code> field.</li><li>It defaults the Shoot Kubernetes version (<code>.spec.kubernetes.version</code> and <code>.spec.provider.workers[].kubernetes.version</code>).</li><li>It defaults the Shoot machine image version (<code>.spec.provider.workers[].machine.image.{name,version}</code>).</li></ul><h2 id="shootnodelocaldnsenabledbydefault" tabindex="-1"><code>ShootNodeLocalDNSEnabledByDefault</code> <a class="header-anchor" href="#shootnodelocaldnsenabledbydefault" aria-label="Permalink to &quot;`ShootNodeLocalDNSEnabledByDefault`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: No.</p><p>This admission controller reacts on <code>CREATE</code> operations for <code>Shoot</code>s. If enabled, it will enable node local dns within the shoot cluster (for more information, see <a href="/docs/gardener/networking/node-local-dns/">NodeLocalDNS Configuration</a>) by setting <code>spec.systemComponents.nodeLocalDNS.enabled=true</code> for newly created Shoots. Already existing Shoots and new Shoots that explicitly disable node local dns (<code>spec.systemComponents.nodeLocalDNS.enabled=false</code>) will not be affected by this admission plugin.</p><h2 id="shootquotavalidator" tabindex="-1"><code>ShootQuotaValidator</code> <a class="header-anchor" href="#shootquotavalidator" aria-label="Permalink to &quot;`ShootQuotaValidator`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>Shoot</code>s. It validates the resource consumption declared in the specification against applicable <code>Quota</code> resources. Only if the applicable <code>Quota</code> resources admit the configured resources in the <code>Shoot</code> then it allows the request. Applicable <code>Quota</code>s are referred in the <code>SecretBinding</code> that is used by the <code>Shoot</code>.</p><h2 id="shootresourcereservation" tabindex="-1"><code>ShootResourceReservation</code> <a class="header-anchor" href="#shootresourcereservation" aria-label="Permalink to &quot;`ShootResourceReservation`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>Shoot</code>s. It injects the <code>Kubernetes.Kubelet.KubeReserved</code> setting for kubelet either as global setting for a shoot or on a per worker pool basis. If the admission configuration (see <a href="https://github.com/gardener/gardener/blob/master/example/20-admissionconfig.yaml" target="_blank" rel="noreferrer">this example</a>) for the <code>ShootResourceReservation</code> plugin contains <code>useGKEFormula: false</code> (the default), then it sets a static default resource reservation for the shoot.</p><p>If <code>useGKEFormula: true</code> is set, then the plugin injects resource reservations based on the machine type similar to GKE&#39;s <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/plan-node-sizes#resource_reservations" target="_blank" rel="noreferrer">formula for resource reservation</a> into each worker pool. Already existing resource reservations are not modified; this also means that resource reservations are not automatically updated if the machine type for a worker pool is changed. If a shoot contains global resource reservations, then no per worker pool resource reservations are injected.</p><p>By default, <code>useGKEFormula: true</code> applies to all Shoots. Operators can provide an optional label selector via the <code>selector</code> field to limit which Shoots get worker specific resource reservations injected.</p><h2 id="shoottolerationrestriction" tabindex="-1"><code>ShootTolerationRestriction</code> <a class="header-anchor" href="#shoottolerationrestriction" aria-label="Permalink to &quot;`ShootTolerationRestriction`&quot;">​</a></h2><p><strong>Type</strong>: Validating and Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> and <code>UPDATE</code> operations for <code>Shoot</code>s. It validates the <code>.spec.tolerations</code> used in <code>Shoot</code>s against the whitelist of its <code>Project</code>, or against the whitelist configured in the admission controller&#39;s configuration, respectively. Additionally, it defaults the <code>.spec.tolerations</code> in <code>Shoot</code>s with those configured in its <code>Project</code>, and those configured in the admission controller&#39;s configuration, respectively.</p><h2 id="shootvpaenabledbydefault" tabindex="-1"><code>ShootVPAEnabledByDefault</code> <a class="header-anchor" href="#shootvpaenabledbydefault" aria-label="Permalink to &quot;`ShootVPAEnabledByDefault`&quot;">​</a></h2><p><strong>Type</strong>: Mutating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code> operations for <code>Shoot</code>s. If enabled, it will enable the managed <code>VerticalPodAutoscaler</code> components (for more information, see <a href="/docs/gardener/autoscaling/shoot_autoscaling/#vertical-pod-auto-scaling">Vertical Pod Auto-Scaling</a>) by setting <code>spec.kubernetes.verticalPodAutoscaler.enabled=true</code> for newly created Shoots. Already existing Shoots and new Shoots that explicitly disable VPA (<code>spec.kubernetes.verticalPodAutoscaler.enabled=false</code>) will not be affected by this admission plugin.</p><h2 id="shootvalidator" tabindex="-1"><code>ShootValidator</code> <a class="header-anchor" href="#shootvalidator" aria-label="Permalink to &quot;`ShootValidator`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller reacts on <code>CREATE</code>, <code>UPDATE</code> and <code>DELETE</code> operations for <code>Shoot</code>s. It validates certain configurations in the specification against the referred <code>CloudProfile</code> (e.g., machine images, machine types, used Kubernetes version, ...). Generally, it performs validations that cannot be handled by the static API validation due to their dynamic nature (e.g., when something needs to be checked against referred resources).</p><h2 id="validatingadmissionpolicy" tabindex="-1"><code>ValidatingAdmissionPolicy</code> <a class="header-anchor" href="#validatingadmissionpolicy" aria-label="Permalink to &quot;`ValidatingAdmissionPolicy`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller is defined in the generic API server library (<code>k8s.io/apiserver</code>). See the <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#validatingadmissionpolicy" target="_blank" rel="noreferrer">ValidatingAdmissionPolicy section</a>.</p><h2 id="validatingadmissionwebhook" tabindex="-1"><code>ValidatingAdmissionWebhook</code> <a class="header-anchor" href="#validatingadmissionwebhook" aria-label="Permalink to &quot;`ValidatingAdmissionWebhook`&quot;">​</a></h2><p><strong>Type</strong>: Validating. <strong>Enabled by default</strong>: Yes.</p><p>This admission controller is defined in the generic API server library (<code>k8s.io/apiserver</code>). See the <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#validatingadmissionwebhook" target="_blank" rel="noreferrer">ValidatingAdmissionWebhook section</a>.</p>',123)]))}const g=o(s,[["render",i]]);export{p as __pageData,g as default};
