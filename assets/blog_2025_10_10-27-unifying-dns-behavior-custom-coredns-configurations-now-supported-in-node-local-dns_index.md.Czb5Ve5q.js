import{_ as o,c as n,o as t,a2 as r}from"./chunks/framework.Bfq10Vlj.js";const p=JSON.parse('{"title":"Unifying DNS Behavior: Custom CoreDNS Configurations Now Supported in node-local-dns","description":"","frontmatter":{"aliases":["/blog/2025/10/27/unifying-dns-behavior-custom-coredns-configurations-now-supported-in-node-local-dns"],"authors":[{"avatar":"https://avatars.githubusercontent.com/DockToFuture","email":"sebastian.stauch@sap.com","login":"DockToFuture","name":"Sebastian Stauch"}],"github_repo":"https://github.com/gardener/documentation","github_subdir":"website/blog/2025/10","linkTitle":"Unifying DNS Behavior: Custom CoreDNS Configurations Now Supported in node-local-dns","newsSubtitle":"October 27, 2025","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/blog/2025/10/10-27-unifying-dns-behavior-custom-coredns-configurations-now-supported-in-node-local-dns.md","to":"10-27-unifying-dns-behavior-custom-coredns-configurations-now-supported-in-node-local-dns.md"},"publishdate":"2025-10-27","title":"Unifying DNS Behavior: Custom CoreDNS Configurations Now Supported in node-local-dns"},"headers":[],"relativePath":"blog/2025/10/10-27-unifying-dns-behavior-custom-coredns-configurations-now-supported-in-node-local-dns/index.md","filePath":"blog/2025/10/10-27-unifying-dns-behavior-custom-coredns-configurations-now-supported-in-node-local-dns.md","lastUpdated":null}'),a={name:"blog/2025/10/10-27-unifying-dns-behavior-custom-coredns-configurations-now-supported-in-node-local-dns/index.md"};function s(i,e,d,c,l,u){return t(),n("div",null,e[0]||(e[0]=[r('<h1 id="unifying-dns-behavior-custom-coredns-configurations-now-supported-in-node-local-dns" tabindex="-1">Unifying DNS Behavior: Custom CoreDNS Configurations Now Supported in node-local-dns <a class="header-anchor" href="#unifying-dns-behavior-custom-coredns-configurations-now-supported-in-node-local-dns" aria-label="Permalink to &quot;Unifying DNS Behavior: Custom CoreDNS Configurations Now Supported in node-local-dns&quot;">​</a></h1><p>Gardener is committed to making <code>node-local-dns</code> a standard feature across all shoot clusters to enhance DNS performance and reliability. A recent enhancement ensures that enabling this feature is a seamless experience, even for clusters with specialized DNS configurations. Gardener now supports applying custom CoreDNS rules directly within <code>node-local-dns</code>.</p><h3 id="the-challenge-inconsistent-dns-resolution" tabindex="-1">The Challenge: Inconsistent DNS Resolution <a class="header-anchor" href="#the-challenge-inconsistent-dns-resolution" aria-label="Permalink to &quot;The Challenge: Inconsistent DNS Resolution&quot;">​</a></h3><p>Previously, enabling <code>node-local-dns</code> could alter the expected DNS resolution behavior for operators who defined custom rules in the <code>coredns-custom</code> ConfigMap. The <code>node-local-dns</code> agent, which acts as a DNS cache on each node, is designed to forward requests to either the in-cluster CoreDNS or directly to upstream DNS servers.</p><p>This created a problem: if a user configured a custom rule (for example, to rewrite an external domain to a cluster-internal service), <code>node-local-dns</code> might forward the request directly to an upstream server, bypassing the main CoreDNS and ignoring the custom rule. This resulted in failed requests and inconsistent behavior compared to clusters without <code>node-local-dns</code>.</p><h3 id="the-solution-applying-custom-rules-to-the-node-cache" tabindex="-1">The Solution: Applying Custom Rules to the Node Cache <a class="header-anchor" href="#the-solution-applying-custom-rules-to-the-node-cache" aria-label="Permalink to &quot;The Solution: Applying Custom Rules to the Node Cache&quot;">​</a></h3><p>To address the inconsistency, Gardener now automatically mounts the <code>coredns-custom</code> ConfigMap into the <code>node-local-dns</code> pods. The Corefile for <code>node-local-dns</code> has been updated to include any custom server blocks (generated-config/custom-server-block.server) or override rules (custom/*.override) specified in this ConfigMap. To get the correct server blocks, a sidecar container is added to the <code>node-local-dns</code> pods. This sidecar reads the server blocks from the <code>coredns-custom</code> ConfigMap and generates a new configuration file with the appropriate bind statement and port mappings. This newly generated configuration file is then imported into the <code>node-local-dns</code> pods.</p><p>This change ensures that the same custom DNS logic is applied at the node-level cache, before any requests are forwarded. As a result, DNS resolution remains consistent whether <code>node-local-dns</code> is active or not, and the previous workaround of forcing all requests through the central CoreDNS is no longer necessary.</p><h3 id="further-information" tabindex="-1">Further Information <a class="header-anchor" href="#further-information" aria-label="Permalink to &quot;Further Information&quot;">​</a></h3><p>For a more detailed look at the implementation, you can review the pull request on GitHub. To see a demonstration of this feature, you can watch the relevant segment from our recent community meeting.</p><ul><li><strong>GitHub Pull Request:</strong><ul><li><a href="https://github.com/gardener/gardener/pull/12893" target="_blank" rel="noreferrer">apply coredns-custom cm also for the node local dns coredns server #12893</a></li><li><a href="https://github.com/gardener/gardener/pull/13160" target="_blank" rel="noreferrer">support server block imports for node-local-dns</a></li></ul></li><li><strong>Recording:</strong> <a href="https://youtu.be/sfByvNPAnz8?t=1052s" target="_blank" rel="noreferrer">Gardener Community Meeting Recording</a></li><li><strong>Documentation:</strong> <a href="/docs/gardener/networking/custom-dns-config/">Custom DNS configuration</a></li></ul>',11)]))}const g=o(a,[["render",s]]);export{p as __pageData,g as default};
